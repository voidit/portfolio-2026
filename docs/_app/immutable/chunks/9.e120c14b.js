import{_ as Oi}from"./preload-helper.a4192956.js";import{s as ni,f as $,g as q,S as pt,j as X,i as jt,Q as _t,d as ht,o as ri,p as Mi,a as ot,h as le,c as at,J as O,q as Re,e as Oe}from"./scheduler.cc4696a9.js";import{S as si,i as oi,b as de,d as ai,m as ce,t as zt,c as hi,a as It,e as pe,g as li}from"./index.3d0bf3b5.js";var Gi={value:()=>{}};function fi(){for(var n=0,o=arguments.length,l={},h;n<o;++n){if(!(h=arguments[n]+"")||h in l||/[\s.]/.test(h))throw new Error("illegal type: "+h);l[h]=[]}return new Ht(l)}function Ht(n){this._=n}function Hi(n,o){return n.trim().split(/^|\s+/).map(function(l){var h="",f=l.indexOf(".");if(f>=0&&(h=l.slice(f+1),l=l.slice(0,f)),l&&!o.hasOwnProperty(l))throw new Error("unknown type: "+l);return{type:l,name:h}})}Ht.prototype=fi.prototype={constructor:Ht,on:function(n,o){var l=this._,h=Hi(n+"",l),f,u=-1,c=h.length;if(arguments.length<2){for(;++u<c;)if((f=(n=h[u]).type)&&(f=Yi(l[f],n.name)))return f;return}if(o!=null&&typeof o!="function")throw new Error("invalid callback: "+o);for(;++u<c;)if(f=(n=h[u]).type)l[f]=Me(l[f],n.name,o);else if(o==null)for(f in l)l[f]=Me(l[f],n.name,null);return this},copy:function(){var n={},o=this._;for(var l in o)n[l]=o[l].slice();return new Ht(n)},call:function(n,o){if((f=arguments.length-2)>0)for(var l=new Array(f),h=0,f,u;h<f;++h)l[h]=arguments[h+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(u=this._[n],h=0,f=u.length;h<f;++h)u[h].value.apply(o,l)},apply:function(n,o,l){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var h=this._[n],f=0,u=h.length;f<u;++f)h[f].value.apply(o,l)}};function Yi(n,o){for(var l=0,h=n.length,f;l<h;++l)if((f=n[l]).name===o)return f.value}function Me(n,o,l){for(var h=0,f=n.length;h<f;++h)if(n[h].name===o){n[h]=Gi,n=n.slice(0,h).concat(n.slice(h+1));break}return l!=null&&n.push({name:o,value:l}),n}var _e="http://www.w3.org/1999/xhtml";const Ge={svg:"http://www.w3.org/2000/svg",xhtml:_e,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Jt(n){var o=n+="",l=o.indexOf(":");return l>=0&&(o=n.slice(0,l))!=="xmlns"&&(n=n.slice(l+1)),Ge.hasOwnProperty(o)?{space:Ge[o],local:n}:n}function Vi(n){return function(){var o=this.ownerDocument,l=this.namespaceURI;return l===_e&&o.documentElement.namespaceURI===_e?o.createElement(n):o.createElementNS(l,n)}}function $i(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function ui(n){var o=Jt(n);return(o.local?$i:Vi)(o)}function qi(){}function xe(n){return n==null?qi:function(){return this.querySelector(n)}}function Xi(n){typeof n!="function"&&(n=xe(n));for(var o=this._groups,l=o.length,h=new Array(l),f=0;f<l;++f)for(var u=o[f],c=u.length,r=h[f]=new Array(c),m,v,_=0;_<c;++_)(m=u[_])&&(v=n.call(m,m.__data__,_,u))&&("__data__"in m&&(v.__data__=m.__data__),r[_]=v);return new H(h,this._parents)}function Ki(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function Wi(){return[]}function di(n){return n==null?Wi:function(){return this.querySelectorAll(n)}}function Zi(n){return function(){return Ki(n.apply(this,arguments))}}function ji(n){typeof n=="function"?n=Zi(n):n=di(n);for(var o=this._groups,l=o.length,h=[],f=[],u=0;u<l;++u)for(var c=o[u],r=c.length,m,v=0;v<r;++v)(m=c[v])&&(h.push(n.call(m,m.__data__,v,c)),f.push(m));return new H(h,f)}function ci(n){return function(){return this.matches(n)}}function pi(n){return function(o){return o.matches(n)}}var Ji=Array.prototype.find;function Qi(n){return function(){return Ji.call(this.children,n)}}function tn(){return this.firstElementChild}function en(n){return this.select(n==null?tn:Qi(typeof n=="function"?n:pi(n)))}var nn=Array.prototype.filter;function rn(){return Array.from(this.children)}function sn(n){return function(){return nn.call(this.children,n)}}function on(n){return this.selectAll(n==null?rn:sn(typeof n=="function"?n:pi(n)))}function an(n){typeof n!="function"&&(n=ci(n));for(var o=this._groups,l=o.length,h=new Array(l),f=0;f<l;++f)for(var u=o[f],c=u.length,r=h[f]=[],m,v=0;v<c;++v)(m=u[v])&&n.call(m,m.__data__,v,u)&&r.push(m);return new H(h,this._parents)}function _i(n){return new Array(n.length)}function hn(){return new H(this._enter||this._groups.map(_i),this._parents)}function $t(n,o){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=o}$t.prototype={constructor:$t,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,o){return this._parent.insertBefore(n,o)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function ln(n){return function(){return n}}function fn(n,o,l,h,f,u){for(var c=0,r,m=o.length,v=u.length;c<v;++c)(r=o[c])?(r.__data__=u[c],h[c]=r):l[c]=new $t(n,u[c]);for(;c<m;++c)(r=o[c])&&(f[c]=r)}function un(n,o,l,h,f,u,c){var r,m,v=new Map,_=o.length,x=u.length,t=new Array(_),e;for(r=0;r<_;++r)(m=o[r])&&(t[r]=e=c.call(m,m.__data__,r,o)+"",v.has(e)?f[r]=m:v.set(e,m));for(r=0;r<x;++r)e=c.call(n,u[r],r,u)+"",(m=v.get(e))?(h[r]=m,m.__data__=u[r],v.delete(e)):l[r]=new $t(n,u[r]);for(r=0;r<_;++r)(m=o[r])&&v.get(t[r])===m&&(f[r]=m)}function dn(n){return n.__data__}function cn(n,o){if(!arguments.length)return Array.from(this,dn);var l=o?un:fn,h=this._parents,f=this._groups;typeof n!="function"&&(n=ln(n));for(var u=f.length,c=new Array(u),r=new Array(u),m=new Array(u),v=0;v<u;++v){var _=h[v],x=f[v],t=x.length,e=pn(n.call(_,_&&_.__data__,v,h)),i=e.length,s=r[v]=new Array(i),a=c[v]=new Array(i),d=m[v]=new Array(t);l(_,x,s,a,d,e,o);for(var p=0,g=0,y,w;p<i;++p)if(y=s[p]){for(p>=g&&(g=p+1);!(w=a[g])&&++g<i;);y._next=w||null}}return c=new H(c,h),c._enter=r,c._exit=m,c}function pn(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function _n(){return new H(this._exit||this._groups.map(_i),this._parents)}function gn(n,o,l){var h=this.enter(),f=this,u=this.exit();return typeof n=="function"?(h=n(h),h&&(h=h.selection())):h=h.append(n+""),o!=null&&(f=o(f),f&&(f=f.selection())),l==null?u.remove():l(u),h&&f?h.merge(f).order():f}function yn(n){for(var o=n.selection?n.selection():n,l=this._groups,h=o._groups,f=l.length,u=h.length,c=Math.min(f,u),r=new Array(f),m=0;m<c;++m)for(var v=l[m],_=h[m],x=v.length,t=r[m]=new Array(x),e,i=0;i<x;++i)(e=v[i]||_[i])&&(t[i]=e);for(;m<f;++m)r[m]=l[m];return new H(r,this._parents)}function mn(){for(var n=this._groups,o=-1,l=n.length;++o<l;)for(var h=n[o],f=h.length-1,u=h[f],c;--f>=0;)(c=h[f])&&(u&&c.compareDocumentPosition(u)^4&&u.parentNode.insertBefore(c,u),u=c);return this}function vn(n){n||(n=wn);function o(x,t){return x&&t?n(x.__data__,t.__data__):!x-!t}for(var l=this._groups,h=l.length,f=new Array(h),u=0;u<h;++u){for(var c=l[u],r=c.length,m=f[u]=new Array(r),v,_=0;_<r;++_)(v=c[_])&&(m[_]=v);m.sort(o)}return new H(f,this._parents).order()}function wn(n,o){return n<o?-1:n>o?1:n>=o?0:NaN}function bn(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function xn(){return Array.from(this)}function Sn(){for(var n=this._groups,o=0,l=n.length;o<l;++o)for(var h=n[o],f=0,u=h.length;f<u;++f){var c=h[f];if(c)return c}return null}function Un(){let n=0;for(const o of this)++n;return n}function En(){return!this.node()}function An(n){for(var o=this._groups,l=0,h=o.length;l<h;++l)for(var f=o[l],u=0,c=f.length,r;u<c;++u)(r=f[u])&&n.call(r,r.__data__,u,f);return this}function Bn(n){return function(){this.removeAttribute(n)}}function Tn(n){return function(){this.removeAttributeNS(n.space,n.local)}}function zn(n,o){return function(){this.setAttribute(n,o)}}function In(n,o){return function(){this.setAttributeNS(n.space,n.local,o)}}function Fn(n,o){return function(){var l=o.apply(this,arguments);l==null?this.removeAttribute(n):this.setAttribute(n,l)}}function kn(n,o){return function(){var l=o.apply(this,arguments);l==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,l)}}function Cn(n,o){var l=Jt(n);if(arguments.length<2){var h=this.node();return l.local?h.getAttributeNS(l.space,l.local):h.getAttribute(l)}return this.each((o==null?l.local?Tn:Bn:typeof o=="function"?l.local?kn:Fn:l.local?In:zn)(l,o))}function gi(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function Ln(n){return function(){this.style.removeProperty(n)}}function Pn(n,o,l){return function(){this.style.setProperty(n,o,l)}}function Dn(n,o,l){return function(){var h=o.apply(this,arguments);h==null?this.style.removeProperty(n):this.style.setProperty(n,h,l)}}function Nn(n,o,l){return arguments.length>1?this.each((o==null?Ln:typeof o=="function"?Dn:Pn)(n,o,l??"")):yt(this.node(),n)}function yt(n,o){return n.style.getPropertyValue(o)||gi(n).getComputedStyle(n,null).getPropertyValue(o)}function Rn(n){return function(){delete this[n]}}function On(n,o){return function(){this[n]=o}}function Mn(n,o){return function(){var l=o.apply(this,arguments);l==null?delete this[n]:this[n]=l}}function Gn(n,o){return arguments.length>1?this.each((o==null?Rn:typeof o=="function"?Mn:On)(n,o)):this.node()[n]}function yi(n){return n.trim().split(/^|\s+/)}function Se(n){return n.classList||new mi(n)}function mi(n){this._node=n,this._names=yi(n.getAttribute("class")||"")}mi.prototype={add:function(n){var o=this._names.indexOf(n);o<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var o=this._names.indexOf(n);o>=0&&(this._names.splice(o,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function vi(n,o){for(var l=Se(n),h=-1,f=o.length;++h<f;)l.add(o[h])}function wi(n,o){for(var l=Se(n),h=-1,f=o.length;++h<f;)l.remove(o[h])}function Hn(n){return function(){vi(this,n)}}function Yn(n){return function(){wi(this,n)}}function Vn(n,o){return function(){(o.apply(this,arguments)?vi:wi)(this,n)}}function $n(n,o){var l=yi(n+"");if(arguments.length<2){for(var h=Se(this.node()),f=-1,u=l.length;++f<u;)if(!h.contains(l[f]))return!1;return!0}return this.each((typeof o=="function"?Vn:o?Hn:Yn)(l,o))}function qn(){this.textContent=""}function Xn(n){return function(){this.textContent=n}}function Kn(n){return function(){var o=n.apply(this,arguments);this.textContent=o??""}}function Wn(n){return arguments.length?this.each(n==null?qn:(typeof n=="function"?Kn:Xn)(n)):this.node().textContent}function Zn(){this.innerHTML=""}function jn(n){return function(){this.innerHTML=n}}function Jn(n){return function(){var o=n.apply(this,arguments);this.innerHTML=o??""}}function Qn(n){return arguments.length?this.each(n==null?Zn:(typeof n=="function"?Jn:jn)(n)):this.node().innerHTML}function tr(){this.nextSibling&&this.parentNode.appendChild(this)}function er(){return this.each(tr)}function ir(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function nr(){return this.each(ir)}function rr(n){var o=typeof n=="function"?n:ui(n);return this.select(function(){return this.appendChild(o.apply(this,arguments))})}function sr(){return null}function or(n,o){var l=typeof n=="function"?n:ui(n),h=o==null?sr:typeof o=="function"?o:xe(o);return this.select(function(){return this.insertBefore(l.apply(this,arguments),h.apply(this,arguments)||null)})}function ar(){var n=this.parentNode;n&&n.removeChild(this)}function hr(){return this.each(ar)}function lr(){var n=this.cloneNode(!1),o=this.parentNode;return o?o.insertBefore(n,this.nextSibling):n}function fr(){var n=this.cloneNode(!0),o=this.parentNode;return o?o.insertBefore(n,this.nextSibling):n}function ur(n){return this.select(n?fr:lr)}function dr(n){return arguments.length?this.property("__data__",n):this.node().__data__}function cr(n){return function(o){n.call(this,o,this.__data__)}}function pr(n){return n.trim().split(/^|\s+/).map(function(o){var l="",h=o.indexOf(".");return h>=0&&(l=o.slice(h+1),o=o.slice(0,h)),{type:o,name:l}})}function _r(n){return function(){var o=this.__on;if(o){for(var l=0,h=-1,f=o.length,u;l<f;++l)u=o[l],(!n.type||u.type===n.type)&&u.name===n.name?this.removeEventListener(u.type,u.listener,u.options):o[++h]=u;++h?o.length=h:delete this.__on}}}function gr(n,o,l){return function(){var h=this.__on,f,u=cr(o);if(h){for(var c=0,r=h.length;c<r;++c)if((f=h[c]).type===n.type&&f.name===n.name){this.removeEventListener(f.type,f.listener,f.options),this.addEventListener(f.type,f.listener=u,f.options=l),f.value=o;return}}this.addEventListener(n.type,u,l),f={type:n.type,name:n.name,value:o,listener:u,options:l},h?h.push(f):this.__on=[f]}}function yr(n,o,l){var h=pr(n+""),f,u=h.length,c;if(arguments.length<2){var r=this.node().__on;if(r){for(var m=0,v=r.length,_;m<v;++m)for(f=0,_=r[m];f<u;++f)if((c=h[f]).type===_.type&&c.name===_.name)return _.value}return}for(r=o?gr:_r,f=0;f<u;++f)this.each(r(h[f],o,l));return this}function bi(n,o,l){var h=gi(n),f=h.CustomEvent;typeof f=="function"?f=new f(o,l):(f=h.document.createEvent("Event"),l?(f.initEvent(o,l.bubbles,l.cancelable),f.detail=l.detail):f.initEvent(o,!1,!1)),n.dispatchEvent(f)}function mr(n,o){return function(){return bi(this,n,o)}}function vr(n,o){return function(){return bi(this,n,o.apply(this,arguments))}}function wr(n,o){return this.each((typeof o=="function"?vr:mr)(n,o))}function*br(){for(var n=this._groups,o=0,l=n.length;o<l;++o)for(var h=n[o],f=0,u=h.length,c;f<u;++f)(c=h[f])&&(yield c)}var xi=[null];function H(n,o){this._groups=n,this._parents=o}function Pt(){return new H([[document.documentElement]],xi)}function xr(){return this}H.prototype=Pt.prototype={constructor:H,select:Xi,selectAll:ji,selectChild:en,selectChildren:on,filter:an,data:cn,enter:hn,exit:_n,join:gn,merge:yn,selection:xr,order:mn,sort:vn,call:bn,nodes:xn,node:Sn,size:Un,empty:En,each:An,attr:Cn,style:Nn,property:Gn,classed:$n,text:Wn,html:Qn,raise:er,lower:nr,append:rr,insert:or,remove:hr,clone:ur,datum:dr,on:yr,dispatch:wr,[Symbol.iterator]:br};function Sr(n){return typeof n=="string"?new H([[document.querySelector(n)]],[document.documentElement]):new H([[n]],xi)}function Ue(n,o,l){n.prototype=o.prototype=l,l.constructor=n}function Si(n,o){var l=Object.create(n.prototype);for(var h in o)l[h]=o[h];return l}function Dt(){}var Ft=.7,qt=1/Ft,gt="\\s*([+-]?\\d+)\\s*",kt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",J="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ur=/^#([0-9a-f]{3,8})$/,Er=new RegExp(`^rgb\\(${gt},${gt},${gt}\\)$`),Ar=new RegExp(`^rgb\\(${J},${J},${J}\\)$`),Br=new RegExp(`^rgba\\(${gt},${gt},${gt},${kt}\\)$`),Tr=new RegExp(`^rgba\\(${J},${J},${J},${kt}\\)$`),zr=new RegExp(`^hsl\\(${kt},${J},${J}\\)$`),Ir=new RegExp(`^hsla\\(${kt},${J},${J},${kt}\\)$`),He={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ue(Dt,Ct,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Ye,formatHex:Ye,formatHex8:Fr,formatHsl:kr,formatRgb:Ve,toString:Ve});function Ye(){return this.rgb().formatHex()}function Fr(){return this.rgb().formatHex8()}function kr(){return Ui(this).formatHsl()}function Ve(){return this.rgb().formatRgb()}function Ct(n){var o,l;return n=(n+"").trim().toLowerCase(),(o=Ur.exec(n))?(l=o[1].length,o=parseInt(o[1],16),l===6?$e(o):l===3?new M(o>>8&15|o>>4&240,o>>4&15|o&240,(o&15)<<4|o&15,1):l===8?Ot(o>>24&255,o>>16&255,o>>8&255,(o&255)/255):l===4?Ot(o>>12&15|o>>8&240,o>>8&15|o>>4&240,o>>4&15|o&240,((o&15)<<4|o&15)/255):null):(o=Er.exec(n))?new M(o[1],o[2],o[3],1):(o=Ar.exec(n))?new M(o[1]*255/100,o[2]*255/100,o[3]*255/100,1):(o=Br.exec(n))?Ot(o[1],o[2],o[3],o[4]):(o=Tr.exec(n))?Ot(o[1]*255/100,o[2]*255/100,o[3]*255/100,o[4]):(o=zr.exec(n))?Ke(o[1],o[2]/100,o[3]/100,1):(o=Ir.exec(n))?Ke(o[1],o[2]/100,o[3]/100,o[4]):He.hasOwnProperty(n)?$e(He[n]):n==="transparent"?new M(NaN,NaN,NaN,0):null}function $e(n){return new M(n>>16&255,n>>8&255,n&255,1)}function Ot(n,o,l,h){return h<=0&&(n=o=l=NaN),new M(n,o,l,h)}function Cr(n){return n instanceof Dt||(n=Ct(n)),n?(n=n.rgb(),new M(n.r,n.g,n.b,n.opacity)):new M}function ge(n,o,l,h){return arguments.length===1?Cr(n):new M(n,o,l,h??1)}function M(n,o,l,h){this.r=+n,this.g=+o,this.b=+l,this.opacity=+h}Ue(M,ge,Si(Dt,{brighter(n){return n=n==null?qt:Math.pow(qt,n),new M(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Ft:Math.pow(Ft,n),new M(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new M(ft(this.r),ft(this.g),ft(this.b),Xt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qe,formatHex:qe,formatHex8:Lr,formatRgb:Xe,toString:Xe}));function qe(){return`#${lt(this.r)}${lt(this.g)}${lt(this.b)}`}function Lr(){return`#${lt(this.r)}${lt(this.g)}${lt(this.b)}${lt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xe(){const n=Xt(this.opacity);return`${n===1?"rgb(":"rgba("}${ft(this.r)}, ${ft(this.g)}, ${ft(this.b)}${n===1?")":`, ${n})`}`}function Xt(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function ft(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function lt(n){return n=ft(n),(n<16?"0":"")+n.toString(16)}function Ke(n,o,l,h){return h<=0?n=o=l=NaN:l<=0||l>=1?n=o=NaN:o<=0&&(n=NaN),new K(n,o,l,h)}function Ui(n){if(n instanceof K)return new K(n.h,n.s,n.l,n.opacity);if(n instanceof Dt||(n=Ct(n)),!n)return new K;if(n instanceof K)return n;n=n.rgb();var o=n.r/255,l=n.g/255,h=n.b/255,f=Math.min(o,l,h),u=Math.max(o,l,h),c=NaN,r=u-f,m=(u+f)/2;return r?(o===u?c=(l-h)/r+(l<h)*6:l===u?c=(h-o)/r+2:c=(o-l)/r+4,r/=m<.5?u+f:2-u-f,c*=60):r=m>0&&m<1?0:c,new K(c,r,m,n.opacity)}function Pr(n,o,l,h){return arguments.length===1?Ui(n):new K(n,o,l,h??1)}function K(n,o,l,h){this.h=+n,this.s=+o,this.l=+l,this.opacity=+h}Ue(K,Pr,Si(Dt,{brighter(n){return n=n==null?qt:Math.pow(qt,n),new K(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Ft:Math.pow(Ft,n),new K(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,o=isNaN(n)||isNaN(this.s)?0:this.s,l=this.l,h=l+(l<.5?l:1-l)*o,f=2*l-h;return new M(fe(n>=240?n-240:n+120,f,h),fe(n,f,h),fe(n<120?n+240:n-120,f,h),this.opacity)},clamp(){return new K(We(this.h),Mt(this.s),Mt(this.l),Xt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Xt(this.opacity);return`${n===1?"hsl(":"hsla("}${We(this.h)}, ${Mt(this.s)*100}%, ${Mt(this.l)*100}%${n===1?")":`, ${n})`}`}}));function We(n){return n=(n||0)%360,n<0?n+360:n}function Mt(n){return Math.max(0,Math.min(1,n||0))}function fe(n,o,l){return(n<60?o+(l-o)*n/60:n<180?l:n<240?o+(l-o)*(240-n)/60:o)*255}const Ei=n=>()=>n;function Dr(n,o){return function(l){return n+l*o}}function Nr(n,o,l){return n=Math.pow(n,l),o=Math.pow(o,l)-n,l=1/l,function(h){return Math.pow(n+h*o,l)}}function Rr(n){return(n=+n)==1?Ai:function(o,l){return l-o?Nr(o,l,n):Ei(isNaN(o)?l:o)}}function Ai(n,o){var l=o-n;return l?Dr(n,l):Ei(isNaN(n)?o:n)}const Ze=function n(o){var l=Rr(o);function h(f,u){var c=l((f=ge(f)).r,(u=ge(u)).r),r=l(f.g,u.g),m=l(f.b,u.b),v=Ai(f.opacity,u.opacity);return function(_){return f.r=c(_),f.g=r(_),f.b=m(_),f.opacity=v(_),f+""}}return h.gamma=n,h}(1);function rt(n,o){return n=+n,o=+o,function(l){return n*(1-l)+o*l}}var ye=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ue=new RegExp(ye.source,"g");function Or(n){return function(){return n}}function Mr(n){return function(o){return n(o)+""}}function Gr(n,o){var l=ye.lastIndex=ue.lastIndex=0,h,f,u,c=-1,r=[],m=[];for(n=n+"",o=o+"";(h=ye.exec(n))&&(f=ue.exec(o));)(u=f.index)>l&&(u=o.slice(l,u),r[c]?r[c]+=u:r[++c]=u),(h=h[0])===(f=f[0])?r[c]?r[c]+=f:r[++c]=f:(r[++c]=null,m.push({i:c,x:rt(h,f)})),l=ue.lastIndex;return l<o.length&&(u=o.slice(l),r[c]?r[c]+=u:r[++c]=u),r.length<2?m[0]?Mr(m[0].x):Or(o):(o=m.length,function(v){for(var _=0,x;_<o;++_)r[(x=m[_]).i]=x.x(v);return r.join("")})}var je=180/Math.PI,me={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Bi(n,o,l,h,f,u){var c,r,m;return(c=Math.sqrt(n*n+o*o))&&(n/=c,o/=c),(m=n*l+o*h)&&(l-=n*m,h-=o*m),(r=Math.sqrt(l*l+h*h))&&(l/=r,h/=r,m/=r),n*h<o*l&&(n=-n,o=-o,m=-m,c=-c),{translateX:f,translateY:u,rotate:Math.atan2(o,n)*je,skewX:Math.atan(m)*je,scaleX:c,scaleY:r}}var Gt;function Hr(n){const o=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return o.isIdentity?me:Bi(o.a,o.b,o.c,o.d,o.e,o.f)}function Yr(n){return n==null||(Gt||(Gt=document.createElementNS("http://www.w3.org/2000/svg","g")),Gt.setAttribute("transform",n),!(n=Gt.transform.baseVal.consolidate()))?me:(n=n.matrix,Bi(n.a,n.b,n.c,n.d,n.e,n.f))}function Ti(n,o,l,h){function f(v){return v.length?v.pop()+" ":""}function u(v,_,x,t,e,i){if(v!==x||_!==t){var s=e.push("translate(",null,o,null,l);i.push({i:s-4,x:rt(v,x)},{i:s-2,x:rt(_,t)})}else(x||t)&&e.push("translate("+x+o+t+l)}function c(v,_,x,t){v!==_?(v-_>180?_+=360:_-v>180&&(v+=360),t.push({i:x.push(f(x)+"rotate(",null,h)-2,x:rt(v,_)})):_&&x.push(f(x)+"rotate("+_+h)}function r(v,_,x,t){v!==_?t.push({i:x.push(f(x)+"skewX(",null,h)-2,x:rt(v,_)}):_&&x.push(f(x)+"skewX("+_+h)}function m(v,_,x,t,e,i){if(v!==x||_!==t){var s=e.push(f(e)+"scale(",null,",",null,")");i.push({i:s-4,x:rt(v,x)},{i:s-2,x:rt(_,t)})}else(x!==1||t!==1)&&e.push(f(e)+"scale("+x+","+t+")")}return function(v,_){var x=[],t=[];return v=n(v),_=n(_),u(v.translateX,v.translateY,_.translateX,_.translateY,x,t),c(v.rotate,_.rotate,x,t),r(v.skewX,_.skewX,x,t),m(v.scaleX,v.scaleY,_.scaleX,_.scaleY,x,t),v=_=null,function(e){for(var i=-1,s=t.length,a;++i<s;)x[(a=t[i]).i]=a.x(e);return x.join("")}}}var Vr=Ti(Hr,"px, ","px)","deg)"),$r=Ti(Yr,", ",")",")"),mt=0,At=0,Et=0,zi=1e3,Kt,Bt,Wt=0,ut=0,Qt=0,Lt=typeof performance=="object"&&performance.now?performance:Date,Ii=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Ee(){return ut||(Ii(qr),ut=Lt.now()+Qt)}function qr(){ut=0}function Zt(){this._call=this._time=this._next=null}Zt.prototype=Fi.prototype={constructor:Zt,restart:function(n,o,l){if(typeof n!="function")throw new TypeError("callback is not a function");l=(l==null?Ee():+l)+(o==null?0:+o),!this._next&&Bt!==this&&(Bt?Bt._next=this:Kt=this,Bt=this),this._call=n,this._time=l,ve()},stop:function(){this._call&&(this._call=null,this._time=1/0,ve())}};function Fi(n,o,l){var h=new Zt;return h.restart(n,o,l),h}function Xr(){Ee(),++mt;for(var n=Kt,o;n;)(o=ut-n._time)>=0&&n._call.call(void 0,o),n=n._next;--mt}function Je(){ut=(Wt=Lt.now())+Qt,mt=At=0;try{Xr()}finally{mt=0,Wr(),ut=0}}function Kr(){var n=Lt.now(),o=n-Wt;o>zi&&(Qt-=o,Wt=n)}function Wr(){for(var n,o=Kt,l,h=1/0;o;)o._call?(h>o._time&&(h=o._time),n=o,o=o._next):(l=o._next,o._next=null,o=n?n._next=l:Kt=l);Bt=n,ve(h)}function ve(n){if(!mt){At&&(At=clearTimeout(At));var o=n-ut;o>24?(n<1/0&&(At=setTimeout(Je,n-Lt.now()-Qt)),Et&&(Et=clearInterval(Et))):(Et||(Wt=Lt.now(),Et=setInterval(Kr,zi)),mt=1,Ii(Je))}}function Qe(n,o,l){var h=new Zt;return o=o==null?0:+o,h.restart(f=>{h.stop(),n(f+o)},o,l),h}var Zr=fi("start","end","cancel","interrupt"),jr=[],ki=0,ti=1,we=2,Yt=3,ei=4,be=5,Vt=6;function te(n,o,l,h,f,u){var c=n.__transition;if(!c)n.__transition={};else if(l in c)return;Jr(n,l,{name:o,index:h,group:f,on:Zr,tween:jr,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:ki})}function Ae(n,o){var l=W(n,o);if(l.state>ki)throw new Error("too late; already scheduled");return l}function Q(n,o){var l=W(n,o);if(l.state>Yt)throw new Error("too late; already running");return l}function W(n,o){var l=n.__transition;if(!l||!(l=l[o]))throw new Error("transition not found");return l}function Jr(n,o,l){var h=n.__transition,f;h[o]=l,l.timer=Fi(u,0,l.time);function u(v){l.state=ti,l.timer.restart(c,l.delay,l.time),l.delay<=v&&c(v-l.delay)}function c(v){var _,x,t,e;if(l.state!==ti)return m();for(_ in h)if(e=h[_],e.name===l.name){if(e.state===Yt)return Qe(c);e.state===ei?(e.state=Vt,e.timer.stop(),e.on.call("interrupt",n,n.__data__,e.index,e.group),delete h[_]):+_<o&&(e.state=Vt,e.timer.stop(),e.on.call("cancel",n,n.__data__,e.index,e.group),delete h[_])}if(Qe(function(){l.state===Yt&&(l.state=ei,l.timer.restart(r,l.delay,l.time),r(v))}),l.state=we,l.on.call("start",n,n.__data__,l.index,l.group),l.state===we){for(l.state=Yt,f=new Array(t=l.tween.length),_=0,x=-1;_<t;++_)(e=l.tween[_].value.call(n,n.__data__,l.index,l.group))&&(f[++x]=e);f.length=x+1}}function r(v){for(var _=v<l.duration?l.ease.call(null,v/l.duration):(l.timer.restart(m),l.state=be,1),x=-1,t=f.length;++x<t;)f[x].call(n,_);l.state===be&&(l.on.call("end",n,n.__data__,l.index,l.group),m())}function m(){l.state=Vt,l.timer.stop(),delete h[o];for(var v in h)return;delete n.__transition}}function Qr(n,o){var l=n.__transition,h,f,u=!0,c;if(l){o=o==null?null:o+"";for(c in l){if((h=l[c]).name!==o){u=!1;continue}f=h.state>we&&h.state<be,h.state=Vt,h.timer.stop(),h.on.call(f?"interrupt":"cancel",n,n.__data__,h.index,h.group),delete l[c]}u&&delete n.__transition}}function ts(n){return this.each(function(){Qr(this,n)})}function es(n,o){var l,h;return function(){var f=Q(this,n),u=f.tween;if(u!==l){h=l=u;for(var c=0,r=h.length;c<r;++c)if(h[c].name===o){h=h.slice(),h.splice(c,1);break}}f.tween=h}}function is(n,o,l){var h,f;if(typeof l!="function")throw new Error;return function(){var u=Q(this,n),c=u.tween;if(c!==h){f=(h=c).slice();for(var r={name:o,value:l},m=0,v=f.length;m<v;++m)if(f[m].name===o){f[m]=r;break}m===v&&f.push(r)}u.tween=f}}function ns(n,o){var l=this._id;if(n+="",arguments.length<2){for(var h=W(this.node(),l).tween,f=0,u=h.length,c;f<u;++f)if((c=h[f]).name===n)return c.value;return null}return this.each((o==null?es:is)(l,n,o))}function Be(n,o,l){var h=n._id;return n.each(function(){var f=Q(this,h);(f.value||(f.value={}))[o]=l.apply(this,arguments)}),function(f){return W(f,h).value[o]}}function Ci(n,o){var l;return(typeof o=="number"?rt:o instanceof Ct?Ze:(l=Ct(o))?(o=l,Ze):Gr)(n,o)}function rs(n){return function(){this.removeAttribute(n)}}function ss(n){return function(){this.removeAttributeNS(n.space,n.local)}}function os(n,o,l){var h,f=l+"",u;return function(){var c=this.getAttribute(n);return c===f?null:c===h?u:u=o(h=c,l)}}function as(n,o,l){var h,f=l+"",u;return function(){var c=this.getAttributeNS(n.space,n.local);return c===f?null:c===h?u:u=o(h=c,l)}}function hs(n,o,l){var h,f,u;return function(){var c,r=l(this),m;return r==null?void this.removeAttribute(n):(c=this.getAttribute(n),m=r+"",c===m?null:c===h&&m===f?u:(f=m,u=o(h=c,r)))}}function ls(n,o,l){var h,f,u;return function(){var c,r=l(this),m;return r==null?void this.removeAttributeNS(n.space,n.local):(c=this.getAttributeNS(n.space,n.local),m=r+"",c===m?null:c===h&&m===f?u:(f=m,u=o(h=c,r)))}}function fs(n,o){var l=Jt(n),h=l==="transform"?$r:Ci;return this.attrTween(n,typeof o=="function"?(l.local?ls:hs)(l,h,Be(this,"attr."+n,o)):o==null?(l.local?ss:rs)(l):(l.local?as:os)(l,h,o))}function us(n,o){return function(l){this.setAttribute(n,o.call(this,l))}}function ds(n,o){return function(l){this.setAttributeNS(n.space,n.local,o.call(this,l))}}function cs(n,o){var l,h;function f(){var u=o.apply(this,arguments);return u!==h&&(l=(h=u)&&ds(n,u)),l}return f._value=o,f}function ps(n,o){var l,h;function f(){var u=o.apply(this,arguments);return u!==h&&(l=(h=u)&&us(n,u)),l}return f._value=o,f}function _s(n,o){var l="attr."+n;if(arguments.length<2)return(l=this.tween(l))&&l._value;if(o==null)return this.tween(l,null);if(typeof o!="function")throw new Error;var h=Jt(n);return this.tween(l,(h.local?cs:ps)(h,o))}function gs(n,o){return function(){Ae(this,n).delay=+o.apply(this,arguments)}}function ys(n,o){return o=+o,function(){Ae(this,n).delay=o}}function ms(n){var o=this._id;return arguments.length?this.each((typeof n=="function"?gs:ys)(o,n)):W(this.node(),o).delay}function vs(n,o){return function(){Q(this,n).duration=+o.apply(this,arguments)}}function ws(n,o){return o=+o,function(){Q(this,n).duration=o}}function bs(n){var o=this._id;return arguments.length?this.each((typeof n=="function"?vs:ws)(o,n)):W(this.node(),o).duration}function xs(n,o){if(typeof o!="function")throw new Error;return function(){Q(this,n).ease=o}}function Ss(n){var o=this._id;return arguments.length?this.each(xs(o,n)):W(this.node(),o).ease}function Us(n,o){return function(){var l=o.apply(this,arguments);if(typeof l!="function")throw new Error;Q(this,n).ease=l}}function Es(n){if(typeof n!="function")throw new Error;return this.each(Us(this._id,n))}function As(n){typeof n!="function"&&(n=ci(n));for(var o=this._groups,l=o.length,h=new Array(l),f=0;f<l;++f)for(var u=o[f],c=u.length,r=h[f]=[],m,v=0;v<c;++v)(m=u[v])&&n.call(m,m.__data__,v,u)&&r.push(m);return new nt(h,this._parents,this._name,this._id)}function Bs(n){if(n._id!==this._id)throw new Error;for(var o=this._groups,l=n._groups,h=o.length,f=l.length,u=Math.min(h,f),c=new Array(h),r=0;r<u;++r)for(var m=o[r],v=l[r],_=m.length,x=c[r]=new Array(_),t,e=0;e<_;++e)(t=m[e]||v[e])&&(x[e]=t);for(;r<h;++r)c[r]=o[r];return new nt(c,this._parents,this._name,this._id)}function Ts(n){return(n+"").trim().split(/^|\s+/).every(function(o){var l=o.indexOf(".");return l>=0&&(o=o.slice(0,l)),!o||o==="start"})}function zs(n,o,l){var h,f,u=Ts(o)?Ae:Q;return function(){var c=u(this,n),r=c.on;r!==h&&(f=(h=r).copy()).on(o,l),c.on=f}}function Is(n,o){var l=this._id;return arguments.length<2?W(this.node(),l).on.on(n):this.each(zs(l,n,o))}function Fs(n){return function(){var o=this.parentNode;for(var l in this.__transition)if(+l!==n)return;o&&o.removeChild(this)}}function ks(){return this.on("end.remove",Fs(this._id))}function Cs(n){var o=this._name,l=this._id;typeof n!="function"&&(n=xe(n));for(var h=this._groups,f=h.length,u=new Array(f),c=0;c<f;++c)for(var r=h[c],m=r.length,v=u[c]=new Array(m),_,x,t=0;t<m;++t)(_=r[t])&&(x=n.call(_,_.__data__,t,r))&&("__data__"in _&&(x.__data__=_.__data__),v[t]=x,te(v[t],o,l,t,v,W(_,l)));return new nt(u,this._parents,o,l)}function Ls(n){var o=this._name,l=this._id;typeof n!="function"&&(n=di(n));for(var h=this._groups,f=h.length,u=[],c=[],r=0;r<f;++r)for(var m=h[r],v=m.length,_,x=0;x<v;++x)if(_=m[x]){for(var t=n.call(_,_.__data__,x,m),e,i=W(_,l),s=0,a=t.length;s<a;++s)(e=t[s])&&te(e,o,l,s,t,i);u.push(t),c.push(_)}return new nt(u,c,o,l)}var Ps=Pt.prototype.constructor;function Ds(){return new Ps(this._groups,this._parents)}function Ns(n,o){var l,h,f;return function(){var u=yt(this,n),c=(this.style.removeProperty(n),yt(this,n));return u===c?null:u===l&&c===h?f:f=o(l=u,h=c)}}function Li(n){return function(){this.style.removeProperty(n)}}function Rs(n,o,l){var h,f=l+"",u;return function(){var c=yt(this,n);return c===f?null:c===h?u:u=o(h=c,l)}}function Os(n,o,l){var h,f,u;return function(){var c=yt(this,n),r=l(this),m=r+"";return r==null&&(m=r=(this.style.removeProperty(n),yt(this,n))),c===m?null:c===h&&m===f?u:(f=m,u=o(h=c,r))}}function Ms(n,o){var l,h,f,u="style."+o,c="end."+u,r;return function(){var m=Q(this,n),v=m.on,_=m.value[u]==null?r||(r=Li(o)):void 0;(v!==l||f!==_)&&(h=(l=v).copy()).on(c,f=_),m.on=h}}function Gs(n,o,l){var h=(n+="")=="transform"?Vr:Ci;return o==null?this.styleTween(n,Ns(n,h)).on("end.style."+n,Li(n)):typeof o=="function"?this.styleTween(n,Os(n,h,Be(this,"style."+n,o))).each(Ms(this._id,n)):this.styleTween(n,Rs(n,h,o),l).on("end.style."+n,null)}function Hs(n,o,l){return function(h){this.style.setProperty(n,o.call(this,h),l)}}function Ys(n,o,l){var h,f;function u(){var c=o.apply(this,arguments);return c!==f&&(h=(f=c)&&Hs(n,c,l)),h}return u._value=o,u}function Vs(n,o,l){var h="style."+(n+="");if(arguments.length<2)return(h=this.tween(h))&&h._value;if(o==null)return this.tween(h,null);if(typeof o!="function")throw new Error;return this.tween(h,Ys(n,o,l??""))}function $s(n){return function(){this.textContent=n}}function qs(n){return function(){var o=n(this);this.textContent=o??""}}function Xs(n){return this.tween("text",typeof n=="function"?qs(Be(this,"text",n)):$s(n==null?"":n+""))}function Ks(n){return function(o){this.textContent=n.call(this,o)}}function Ws(n){var o,l;function h(){var f=n.apply(this,arguments);return f!==l&&(o=(l=f)&&Ks(f)),o}return h._value=n,h}function Zs(n){var o="text";if(arguments.length<1)return(o=this.tween(o))&&o._value;if(n==null)return this.tween(o,null);if(typeof n!="function")throw new Error;return this.tween(o,Ws(n))}function js(){for(var n=this._name,o=this._id,l=Pi(),h=this._groups,f=h.length,u=0;u<f;++u)for(var c=h[u],r=c.length,m,v=0;v<r;++v)if(m=c[v]){var _=W(m,o);te(m,n,l,v,c,{time:_.time+_.delay+_.duration,delay:0,duration:_.duration,ease:_.ease})}return new nt(h,this._parents,n,l)}function Js(){var n,o,l=this,h=l._id,f=l.size();return new Promise(function(u,c){var r={value:c},m={value:function(){--f===0&&u()}};l.each(function(){var v=Q(this,h),_=v.on;_!==n&&(o=(n=_).copy(),o._.cancel.push(r),o._.interrupt.push(r),o._.end.push(m)),v.on=o}),f===0&&u()})}var Qs=0;function nt(n,o,l,h){this._groups=n,this._parents=o,this._name=l,this._id=h}function Pi(){return++Qs}var it=Pt.prototype;nt.prototype={constructor:nt,select:Cs,selectAll:Ls,selectChild:it.selectChild,selectChildren:it.selectChildren,filter:As,merge:Bs,selection:Ds,transition:js,call:it.call,nodes:it.nodes,node:it.node,size:it.size,empty:it.empty,each:it.each,on:Is,attr:fs,attrTween:_s,style:Gs,styleTween:Vs,text:Xs,textTween:Zs,remove:ks,tween:ns,delay:ms,duration:bs,ease:Ss,easeVarying:Es,end:Js,[Symbol.iterator]:it[Symbol.iterator]};function to(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var eo={time:null,delay:0,duration:250,ease:to};function io(n,o){for(var l;!(l=n.__transition)||!(l=l[o]);)if(!(n=n.parentNode))throw new Error(`transition ${o} not found`);return l}function no(n){var o,l;n instanceof nt?(o=n._id,n=n._name):(o=Pi(),(l=eo).time=Ee(),n=n==null?null:n+"");for(var h=this._groups,f=h.length,u=0;u<f;++u)for(var c=h[u],r=c.length,m,v=0;v<r;++v)(m=c[v])&&te(m,n,o,v,c,l||io(m,o));return new nt(h,this._parents,n,o)}Pt.prototype.interrupt=ts;Pt.prototype.transition=no;function Tt(n,o,l){this.k=n,this.x=o,this.y=l}Tt.prototype={constructor:Tt,scale:function(n){return n===1?this:new Tt(this.k*n,this.x,this.y)},translate:function(n,o){return n===0&o===0?this:new Tt(this.k,this.x+this.k*n,this.y+this.k*o)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Tt.prototype;function ro(n){let o,l="";return{c(){o=$("div"),o.innerHTML=l,this.h()},l(h){o=q(h,"DIV",{class:!0,"data-svelte-h":!0}),pt(o)!=="svelte-1ezmei5"&&(o.innerHTML=l),this.h()},h(){X(o,"class","w-full border rounded-lg p-4")},m(h,f){jt(h,o,f),n[2](o)},p:_t,i:_t,o:_t,d(h){h&&ht(o),n[2](null)}}}function so(n,o,l){let{data:h=[4,8,15,16,23,42]}=o,f;ri(()=>{Sr(f).append("svg").attr("width","100%").attr("height",200).selectAll("rect").data(h).enter().append("rect").attr("x",(r,m)=>m*45).attr("y",r=>200-r*4).attr("width",40).attr("height",r=>r*4).attr("fill","teal")});function u(c){Mi[c?"unshift":"push"](()=>{f=c,l(0,f)})}return n.$$set=c=>{"data"in c&&l(1,h=c.data)},[f,h,u]}class oo extends si{constructor(o){super(),oi(this,o,so,ro,ni,{data:1})}}var ao=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ii={exports:{}};(function(n,o){(function(l,h){var f="1.0.41",u="",c="?",r="function",m="undefined",v="object",_="string",x="major",t="model",e="name",i="type",s="vendor",a="version",d="architecture",p="console",g="mobile",y="tablet",w="smarttv",b="wearable",U="embedded",T=500,S="Amazon",I="Apple",D="ASUS",L="BlackBerry",C="Browser",N="Chrome",R="Edge",G="Firefox",tt="Google",dt="Honor",Y="Huawei",st="Lenovo",B="LG",ee="Microsoft",ie="Motorola",ne="Nvidia",Te="OnePlus",vt="Opera",re="OPPO",wt="Samsung",ze="Sharp",bt="Sony",se="Xiaomi",oe="Zebra",Ie="Facebook",Fe="Chromium OS",ke="Mac OS",Ce=" Browser",Di=function(z,F){var A={};for(var P in z)F[P]&&F[P].length%2===0?A[P]=F[P].concat(z[P]):A[P]=z[P];return A},Nt=function(z){for(var F={},A=0;A<z.length;A++)F[z[A].toUpperCase()]=z[A];return F},Le=function(z,F){return typeof z===_?xt(F).indexOf(xt(z))!==-1:!1},xt=function(z){return z.toLowerCase()},Ni=function(z){return typeof z===_?z.replace(/[^\d\.]/g,u).split(".")[0]:h},ae=function(z,F){if(typeof z===_)return z=z.replace(/^\s\s*/,u),typeof F===m?z:z.substring(0,T)},St=function(z,F){for(var A=0,P,et,Z,k,E,j;A<F.length&&!E;){var he=F[A],Ne=F[A+1];for(P=et=0;P<he.length&&!E&&he[P];)if(E=he[P++].exec(z),E)for(Z=0;Z<Ne.length;Z++)j=E[++et],k=Ne[Z],typeof k===v&&k.length>0?k.length===2?typeof k[1]==r?this[k[0]]=k[1].call(this,j):this[k[0]]=k[1]:k.length===3?typeof k[1]===r&&!(k[1].exec&&k[1].test)?this[k[0]]=j?k[1].call(this,j,k[2]):h:this[k[0]]=j?j.replace(k[1],k[2]):h:k.length===4&&(this[k[0]]=j?k[3].call(this,j.replace(k[1],k[2])):h):this[k]=j||h;A+=2}},Ut=function(z,F){for(var A in F)if(typeof F[A]===v&&F[A].length>0){for(var P=0;P<F[A].length;P++)if(Le(F[A][P],z))return A===c?h:A}else if(Le(F[A],z))return A===c?h:A;return F.hasOwnProperty("*")?F["*"]:z},Ri={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Pe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},De={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[a,[e,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[a,[e,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[e,a],[/opios[\/ ]+([\w\.]+)/i],[a,[e,vt+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[a,[e,vt+" GX"]],[/\bopr\/([\w\.]+)/i],[a,[e,vt]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[a,[e,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[a,[e,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[e,a],[/quark(?:pc)?\/([-\w\.]+)/i],[a,[e,"Quark"]],[/\bddg\/([\w\.]+)/i],[a,[e,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[a,[e,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[a,[e,"WeChat"]],[/konqueror\/([\w\.]+)/i],[a,[e,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[a,[e,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[a,[e,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[a,[e,"Smart Lenovo "+C]],[/(avast|avg)\/([\w\.]+)/i],[[e,/(.+)/,"$1 Secure "+C],a],[/\bfocus\/([\w\.]+)/i],[a,[e,G+" Focus"]],[/\bopt\/([\w\.]+)/i],[a,[e,vt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[a,[e,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[a,[e,"Dolphin"]],[/coast\/([\w\.]+)/i],[a,[e,vt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[a,[e,"MIUI"+Ce]],[/fxios\/([\w\.-]+)/i],[a,[e,G]],[/\bqihoobrowser\/?([\w\.]*)/i],[a,[e,"360"]],[/\b(qq)\/([\w\.]+)/i],[[e,/(.+)/,"$1Browser"],a],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[e,/(.+)/,"$1"+Ce],a],[/samsungbrowser\/([\w\.]+)/i],[a,[e,wt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[a,[e,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[e,"Sogou Mobile"],a],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[e,a],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[e],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[a,e],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[e,Ie],a],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[e,a],[/\bgsa\/([\w\.]+) .*safari\//i],[a,[e,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[a,[e,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[a,[e,N+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[e,N+" WebView"],a],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[a,[e,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[e,a],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[a,[e,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[a,e],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[e,[a,Ut,Ri]],[/(webkit|khtml)\/([\w\.]+)/i],[e,a],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[e,"Netscape"],a],[/(wolvic|librewolf)\/([\w\.]+)/i],[e,a],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[a,[e,G+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[e,[a,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[e,[a,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[d,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[d,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[d,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[d,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[d,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[d,/ower/,u,xt]],[/ sun4\w[;\)]/i],[[d,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[d,xt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[t,[s,wt],[i,y]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[t,[s,wt],[i,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[t,[s,I],[i,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[t,[s,I],[i,y]],[/(macintosh);/i],[t,[s,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[t,[s,ze],[i,g]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[t,[s,dt],[i,y]],[/honor([-\w ]+)[;\)]/i],[t,[s,dt],[i,g]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[t,[s,Y],[i,y]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[t,[s,Y],[i,g]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[t,/_/g," "],[s,se],[i,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[t,/_/g," "],[s,se],[i,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[t,[s,re],[i,g]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[t,[s,Ut,{OnePlus:["304","403","203"],"*":re}],[i,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[t,[s,"Vivo"],[i,g]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[t,[s,"Realme"],[i,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[t,[s,ie],[i,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[t,[s,ie],[i,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[t,[s,B],[i,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[t,[s,B],[i,g]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[t,[s,st],[i,y]],[/(nokia) (t[12][01])/i],[s,t,[i,y]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[t,/_/g," "],[i,g],[s,"Nokia"]],[/(pixel (c|tablet))\b/i],[t,[s,tt],[i,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[t,[s,tt],[i,g]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[t,[s,bt],[i,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[t,"Xperia Tablet"],[s,bt],[i,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[t,[s,Te],[i,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[t,[s,S],[i,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[t,/(.+)/g,"Fire Phone $1"],[s,S],[i,g]],[/(playbook);[-\w\),; ]+(rim)/i],[t,s,[i,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[t,[s,L],[i,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[t,[s,D],[i,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[t,[s,D],[i,g]],[/(nexus 9)/i],[t,[s,"HTC"],[i,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[s,[t,/_/g," "],[i,g]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[t,[s,"TCL"],[i,y]],[/(itel) ((\w+))/i],[[s,xt],t,[i,Ut,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[t,[s,"Acer"],[i,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[t,[s,"Meizu"],[i,g]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[t,[s,"Ulefone"],[i,g]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[t,[s,"Energizer"],[i,g]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[t,[s,"Cat"],[i,g]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[t,[s,"Smartfren"],[i,g]],[/droid.+; (a(?:015|06[35]|142p?))/i],[t,[s,"Nothing"],[i,g]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[t,[s,"Archos"],[i,y]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[t,[s,"Archos"],[i,g]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[s,t,[i,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[s,t,[i,g]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[s,t,[i,y]],[/(surface duo)/i],[t,[s,ee],[i,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[t,[s,"Fairphone"],[i,g]],[/(u304aa)/i],[t,[s,"AT&T"],[i,g]],[/\bsie-(\w*)/i],[t,[s,"Siemens"],[i,g]],[/\b(rct\w+) b/i],[t,[s,"RCA"],[i,y]],[/\b(venue[\d ]{2,7}) b/i],[t,[s,"Dell"],[i,y]],[/\b(q(?:mv|ta)\w+) b/i],[t,[s,"Verizon"],[i,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[t,[s,"Barnes & Noble"],[i,y]],[/\b(tm\d{3}\w+) b/i],[t,[s,"NuVision"],[i,y]],[/\b(k88) b/i],[t,[s,"ZTE"],[i,y]],[/\b(nx\d{3}j) b/i],[t,[s,"ZTE"],[i,g]],[/\b(gen\d{3}) b.+49h/i],[t,[s,"Swiss"],[i,g]],[/\b(zur\d{3}) b/i],[t,[s,"Swiss"],[i,y]],[/\b((zeki)?tb.*\b) b/i],[t,[s,"Zeki"],[i,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[s,"Dragon Touch"],t,[i,y]],[/\b(ns-?\w{0,9}) b/i],[t,[s,"Insignia"],[i,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[t,[s,"NextBook"],[i,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[s,"Voice"],t,[i,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[s,"LvTel"],t,[i,g]],[/\b(ph-1) /i],[t,[s,"Essential"],[i,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[t,[s,"Envizen"],[i,y]],[/\b(trio[-\w\. ]+) b/i],[t,[s,"MachSpeed"],[i,y]],[/\btu_(1491) b/i],[t,[s,"Rotor"],[i,y]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[t,[s,ne],[i,y]],[/(sprint) (\w+)/i],[s,t,[i,g]],[/(kin\.[onetw]{3})/i],[[t,/\./g," "],[s,ee],[i,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[t,[s,oe],[i,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[t,[s,oe],[i,g]],[/smart-tv.+(samsung)/i],[s,[i,w]],[/hbbtv.+maple;(\d+)/i],[[t,/^/,"SmartTV"],[s,wt],[i,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[s,B],[i,w]],[/(apple) ?tv/i],[s,[t,I+" TV"],[i,w]],[/crkey/i],[[t,N+"cast"],[s,tt],[i,w]],[/droid.+aft(\w+)( bui|\))/i],[t,[s,S],[i,w]],[/(shield \w+ tv)/i],[t,[s,ne],[i,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[t,[s,ze],[i,w]],[/(bravia[\w ]+)( bui|\))/i],[t,[s,bt],[i,w]],[/(mi(tv|box)-?\w+) bui/i],[t,[s,se],[i,w]],[/Hbbtv.*(technisat) (.*);/i],[s,t,[i,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[s,ae],[t,ae],[i,w]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[t,[i,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[i,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[s,t,[i,p]],[/droid.+; (shield)( bui|\))/i],[t,[s,ne],[i,p]],[/(playstation \w+)/i],[t,[s,bt],[i,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[t,[s,ee],[i,p]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[t,[s,wt],[i,b]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[s,t,[i,b]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[t,[s,re],[i,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[t,[s,I],[i,b]],[/(opwwe\d{3})/i],[t,[s,Te],[i,b]],[/(moto 360)/i],[t,[s,ie],[i,b]],[/(smartwatch 3)/i],[t,[s,bt],[i,b]],[/(g watch r)/i],[t,[s,B],[i,b]],[/droid.+; (wt63?0{2,3})\)/i],[t,[s,oe],[i,b]],[/droid.+; (glass) \d/i],[t,[s,tt],[i,b]],[/(pico) (4|neo3(?: link|pro)?)/i],[s,t,[i,b]],[/; (quest( \d| pro)?)/i],[t,[s,Ie],[i,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[s,[i,U]],[/(aeobc)\b/i],[t,[s,S],[i,U]],[/(homepod).+mac os/i],[t,[s,I],[i,U]],[/windows iot/i],[[i,U]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[t,[i,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[t,[i,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[i,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[i,g]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[t,[s,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[a,[e,R+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[e,a],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[a,[e,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[e,a],[/ladybird\//i],[[e,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[a,e]],os:[[/microsoft (windows) (vista|xp)/i],[e,a],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[e,[a,Ut,Pe]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[a,Ut,Pe],[e,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[a,/_/g,"."],[e,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[e,ke],[a,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[a,e],[/(ubuntu) ([\w\.]+) like android/i],[[e,/(.+)/,"$1 Touch"],a],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[e,a],[/\(bb(10);/i],[a,[e,L]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[a,[e,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[a,[e,G+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[a,[e,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[a,[e,"watchOS"]],[/crkey\/([\d\.]+)/i],[a,[e,N+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[e,Fe],a],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[e,a],[/(sunos) ?([\w\.\d]*)/i],[[e,"Solaris"],a],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[e,a]]},V=function(z,F){if(typeof z===v&&(F=z,z=h),!(this instanceof V))return new V(z,F).getResult();var A=typeof l!==m&&l.navigator?l.navigator:h,P=z||(A&&A.userAgent?A.userAgent:u),et=A&&A.userAgentData?A.userAgentData:h,Z=F?Di(De,F):De,k=A&&A.userAgent==P;return this.getBrowser=function(){var E={};return E[e]=h,E[a]=h,St.call(E,P,Z.browser),E[x]=Ni(E[a]),k&&A&&A.brave&&typeof A.brave.isBrave==r&&(E[e]="Brave"),E},this.getCPU=function(){var E={};return E[d]=h,St.call(E,P,Z.cpu),E},this.getDevice=function(){var E={};return E[s]=h,E[t]=h,E[i]=h,St.call(E,P,Z.device),k&&!E[i]&&et&&et.mobile&&(E[i]=g),k&&E[t]=="Macintosh"&&A&&typeof A.standalone!==m&&A.maxTouchPoints&&A.maxTouchPoints>2&&(E[t]="iPad",E[i]=y),E},this.getEngine=function(){var E={};return E[e]=h,E[a]=h,St.call(E,P,Z.engine),E},this.getOS=function(){var E={};return E[e]=h,E[a]=h,St.call(E,P,Z.os),k&&!E[e]&&et&&et.platform&&et.platform!="Unknown"&&(E[e]=et.platform.replace(/chrome os/i,Fe).replace(/macos/i,ke)),E},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return P},this.setUA=function(E){return P=typeof E===_&&E.length>T?ae(E,T):E,this},this.setUA(P),this};V.VERSION=f,V.BROWSER=Nt([e,a,x]),V.CPU=Nt([d]),V.DEVICE=Nt([t,s,i,p,g,w,y,b,U]),V.ENGINE=V.OS=Nt([e,a]),n.exports&&(o=n.exports=V),o.UAParser=V;var ct=typeof l!==m&&(l.jQuery||l.Zepto);if(ct&&!ct.ua){var Rt=new V;ct.ua=Rt.getResult(),ct.ua.get=function(){return Rt.getUA()},ct.ua.set=function(z){Rt.setUA(z);var F=Rt.getResult();for(var A in F)ct.ua[A]=F[A]}}})(typeof window=="object"?window:ao)})(ii,ii.exports);var ho={};(function(n){var o=function(){var t=new Date,e=4,i=3,s=2,a=1,d=e,p={setLogLevel:function(g){g==this.debug?d=a:g==this.info?d=s:g==this.warn?d=i:(g==this.error,d=e)},debug:function(g,y){console.debug===void 0&&(console.debug=console.log),a>=d&&console.debug("["+o.getDurationString(new Date-t,1e3)+"]","["+g+"]",y)},log:function(g,y){this.debug(g.msg)},info:function(g,y){s>=d&&console.info("["+o.getDurationString(new Date-t,1e3)+"]","["+g+"]",y)},warn:function(g,y){i>=d&&console.warn("["+o.getDurationString(new Date-t,1e3)+"]","["+g+"]",y)},error:function(g,y){e>=d&&console.error("["+o.getDurationString(new Date-t,1e3)+"]","["+g+"]",y)}};return p}();o.getDurationString=function(t,e){var i;function s(w,b){for(var U=""+w,T=U.split(".");T[0].length<b;)T[0]="0"+T[0];return T.join(".")}t<0?(i=!0,t=-t):i=!1;var a=e||1,d=t/a,p=Math.floor(d/3600);d-=p*3600;var g=Math.floor(d/60);d-=g*60;var y=d*1e3;return d=Math.floor(d),y-=d*1e3,y=Math.floor(y),(i?"-":"")+p+":"+s(g,2)+":"+s(d,2)+"."+s(y,3)},o.printRanges=function(t){var e=t.length;if(e>0){for(var i="",s=0;s<e;s++)s>0&&(i+=","),i+="["+o.getDurationString(t.start(s))+","+o.getDurationString(t.end(s))+"]";return i}else return"(empty)"},n.Log=o;var l=function(t){if(t instanceof ArrayBuffer)this.buffer=t,this.dataview=new DataView(t);else throw"Needs an array buffer";this.position=0};l.prototype.getPosition=function(){return this.position},l.prototype.getEndPosition=function(){return this.buffer.byteLength},l.prototype.getLength=function(){return this.buffer.byteLength},l.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0},l.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},l.prototype.readAnyInt=function(t,e){var i=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:e?i=this.dataview.getInt8(this.position):i=this.dataview.getUint8(this.position);break;case 2:e?i=this.dataview.getInt16(this.position):i=this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";i=this.dataview.getUint8(this.position)<<16,i|=this.dataview.getUint8(this.position+1)<<8,i|=this.dataview.getUint8(this.position+2);break;case 4:e?i=this.dataview.getInt32(this.position):i=this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";i=this.dataview.getUint32(this.position)<<32,i|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,i}else throw"Not enough bytes in buffer"},l.prototype.readUint8=function(){return this.readAnyInt(1,!1)},l.prototype.readUint16=function(){return this.readAnyInt(2,!1)},l.prototype.readUint24=function(){return this.readAnyInt(3,!1)},l.prototype.readUint32=function(){return this.readAnyInt(4,!1)},l.prototype.readUint64=function(){return this.readAnyInt(8,!1)},l.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readUint8());return e}else throw"Not enough bytes in buffer"},l.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(e!==0)t.push(e);else break}return String.fromCharCode.apply(null,t)},l.prototype.readInt8=function(){return this.readAnyInt(1,!0)},l.prototype.readInt16=function(){return this.readAnyInt(2,!0)},l.prototype.readInt32=function(){return this.readAnyInt(4,!0)},l.prototype.readInt64=function(){return this.readAnyInt(8,!1)},l.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.readUint8();return e},l.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readInt16();return e},l.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readUint16();return e},l.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),i=0;i<t;i++)e[i]=this.readUint32();return e},l.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=this.readInt32();return e},n.MP4BoxStream=l;var h=function(t,e,i){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:typeof t=="object"?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=i??h.LITTLE_ENDIAN};h.prototype={},h.prototype.getPosition=function(){return this.position},h.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,i=this._buffer.byteLength;if(e<=i){e>this._byteLength&&(this._byteLength=e);return}for(i<1&&(i=1);e>i;)i*=2;var s=new ArrayBuffer(i),a=new Uint8Array(this._buffer),d=new Uint8Array(s,0,a.length);d.set(a),this.buffer=s,this._byteLength=e}},h.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),i=new Uint8Array(this._buffer,0,e.length);e.set(i),this.buffer=t}},h.BIG_ENDIAN=!1,h.LITTLE_ENDIAN=!0,h.prototype._byteLength=0,Object.defineProperty(h.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(h.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(h.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(h.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),h.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},h.prototype.isEof=function(){return this.position>=this._byteLength},h.prototype.mapUint8Array=function(t){this._realloc(t*1);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},h.prototype.readInt32Array=function(t,e){t=t??this.byteLength-this.position/4;var i=new Int32Array(t);return h.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),h.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i},h.prototype.readInt16Array=function(t,e){t=t??this.byteLength-this.position/2;var i=new Int16Array(t);return h.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),h.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i},h.prototype.readInt8Array=function(t){t=t??this.byteLength-this.position;var e=new Int8Array(t);return h.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},h.prototype.readUint32Array=function(t,e){t=t??this.byteLength-this.position/4;var i=new Uint32Array(t);return h.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),h.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i},h.prototype.readUint16Array=function(t,e){t=t??this.byteLength-this.position/2;var i=new Uint16Array(t);return h.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),h.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i},h.prototype.readUint8Array=function(t){t=t??this.byteLength-this.position;var e=new Uint8Array(t);return h.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},h.prototype.readFloat64Array=function(t,e){t=t??this.byteLength-this.position/8;var i=new Float64Array(t);return h.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),h.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i},h.prototype.readFloat32Array=function(t,e){t=t??this.byteLength-this.position/4;var i=new Float32Array(t);return h.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),h.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i},h.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,t??this.endianness);return this.position+=4,e},h.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,t??this.endianness);return this.position+=2,e},h.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},h.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,t??this.endianness);return this.position+=4,e},h.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,t??this.endianness);return this.position+=2,e},h.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},h.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,t??this.endianness);return this.position+=4,e},h.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,t??this.endianness);return this.position+=8,e},h.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,h.memcpy=function(t,e,i,s,a){var d=new Uint8Array(t,e,a),p=new Uint8Array(i,s,a);d.set(p)},h.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},h.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},h.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=t.BYTES_PER_ELEMENT)for(var s=i+t.BYTES_PER_ELEMENT-1,a=i;s>a;s--,a++){var d=e[a];e[a]=e[s],e[s]=d}return t},h.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return String.fromCharCode.apply(null,e)},h.prototype.readString=function(t,e){return e==null||e=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(t??this.byteLength-this.position)]):new TextDecoder(e).decode(this.mapUint8Array(t))},h.prototype.readCString=function(t){var e=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),s=e;t!=null&&(s=Math.min(t,e));for(var a=0;a<s&&i[a]!==0;a++);var d=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(a)]);return t!=null?this.position+=s-a:a!=e&&(this.position+=1),d};var f=Math.pow(2,32);h.prototype.readInt64=function(){return this.readInt32()*f+this.readUint32()},h.prototype.readUint64=function(){return this.readUint32()*f+this.readUint32()},h.prototype.readInt64=function(){return this.readUint32()*f+this.readUint32()},h.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},n.DataStream=h,h.prototype.save=function(t){var e=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var i=window.URL.createObjectURL(e),s=document.createElement("a");document.body.appendChild(s),s.setAttribute("href",i),s.setAttribute("download",t),s.setAttribute("target","_self"),s.click(),window.URL.revokeObjectURL(i)}else throw"DataStream.save: Can't create object URL."},h.prototype._dynamicSize=!0,Object.defineProperty(h.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),h.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),i=new Uint8Array(e),s=new Uint8Array(this._buffer,t,i.length);i.set(s),this.buffer=e,this.position-=t},h.prototype.writeInt32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt32(t[i],e)},h.prototype.writeInt16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt16(t[i],e)},h.prototype.writeInt8Array=function(t){if(this._realloc(t.length*1),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},h.prototype.writeUint32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint32(t[i],e)},h.prototype.writeUint16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint16(t[i],e)},h.prototype.writeUint8Array=function(t){if(this._realloc(t.length*1),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},h.prototype.writeFloat64Array=function(t,e){if(this._realloc(t.length*8),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat64(t[i],e)},h.prototype.writeFloat32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat32(t[i],e)},h.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,e??this.endianness),this.position+=4},h.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,e??this.endianness),this.position+=2},h.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},h.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,e??this.endianness),this.position+=4},h.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,e??this.endianness),this.position+=2},h.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},h.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,e??this.endianness),this.position+=4},h.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,e??this.endianness),this.position+=8},h.prototype.writeUCS2String=function(t,e,i){i==null&&(i=t.length);for(var s=0;s<t.length&&s<i;s++)this.writeUint16(t.charCodeAt(s),e);for(;s<i;s++)this.writeUint16(0)},h.prototype.writeString=function(t,e,i){var s=0;if(e==null||e=="ASCII")if(i!=null){var a=Math.min(t.length,i);for(s=0;s<a;s++)this.writeUint8(t.charCodeAt(s));for(;s<i;s++)this.writeUint8(0)}else for(s=0;s<t.length;s++)this.writeUint8(t.charCodeAt(s));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,i)))},h.prototype.writeCString=function(t,e){var i=0;if(e!=null){var s=Math.min(t.length,e);for(i=0;i<s;i++)this.writeUint8(t.charCodeAt(i));for(;i<e;i++)this.writeUint8(0)}else{for(i=0;i<t.length;i++)this.writeUint8(t.charCodeAt(i));this.writeUint8(0)}},h.prototype.writeStruct=function(t,e){for(var i=0;i<t.length;i+=2){var s=t[i+1];this.writeType(s,e[t[i]],e)}},h.prototype.writeType=function(t,e,i){var s;if(typeof t=="function")return t(this,e);if(typeof t=="object"&&!(t instanceof Array))return t.set(this,e,i);var a=null,d="ASCII",p=this.position;switch(typeof t=="string"&&/:/.test(t)&&(s=t.split(":"),t=s[0],a=parseInt(s[1])),typeof t=="string"&&/,/.test(t)&&(s=t.split(","),t=s[0],d=parseInt(s[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,h.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,h.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,h.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,h.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,h.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,h.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,h.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,h.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,h.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,h.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,h.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,h.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,a);break;case"string":this.writeString(e,d,a);break;case"u16string":this.writeUCS2String(e,this.endianness,a);break;case"u16stringle":this.writeUCS2String(e,h.LITTLE_ENDIAN,a);break;case"u16stringbe":this.writeUCS2String(e,h.BIG_ENDIAN,a);break;default:if(t.length==3){for(var g=t[1],y=0;y<e.length;y++)this.writeType(g,e[y]);break}else{this.writeStruct(t,e);break}}a!=null&&(this.position=p,this._realloc(a),this.position=p+a)},h.prototype.writeUint64=function(t){var e=Math.floor(t/f);this.writeUint32(e),this.writeUint32(t&4294967295)},h.prototype.writeUint24=function(t){this.writeUint8((t&16711680)>>16),this.writeUint8((t&65280)>>8),this.writeUint8(t&255)},h.prototype.adjustUint32=function(t,e){var i=this.position;this.seek(t),this.writeUint32(e),this.seek(i)},h.prototype.mapInt32Array=function(t,e){this._realloc(t*4);var i=new Int32Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(i,e??this.endianness),this.position+=t*4,i},h.prototype.mapInt16Array=function(t,e){this._realloc(t*2);var i=new Int16Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(i,e??this.endianness),this.position+=t*2,i},h.prototype.mapInt8Array=function(t){this._realloc(t*1);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},h.prototype.mapUint32Array=function(t,e){this._realloc(t*4);var i=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(i,e??this.endianness),this.position+=t*4,i},h.prototype.mapUint16Array=function(t,e){this._realloc(t*2);var i=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(i,e??this.endianness),this.position+=t*2,i},h.prototype.mapFloat64Array=function(t,e){this._realloc(t*8);var i=new Float64Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(i,e??this.endianness),this.position+=t*8,i},h.prototype.mapFloat32Array=function(t,e){this._realloc(t*4);var i=new Float32Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(i,e??this.endianness),this.position+=t*4,i};var u=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};u.prototype=new h(new ArrayBuffer,0,h.BIG_ENDIAN),u.prototype.initialized=function(){var t;return this.bufferIndex>-1?!0:this.buffers.length>0?(t=this.buffers[0],t.fileStart===0?(this.buffer=t,this.bufferIndex=0,o.debug("MultiBufferStream","Stream ready for parsing"),!0):(o.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(o.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(t,e){o.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer},u.prototype.reduceBuffer=function(t,e,i){var s;return s=new Uint8Array(i),s.set(new Uint8Array(t,e,i)),s.buffer.fileStart=t.fileStart+e,s.buffer.usedBytes=0,s.buffer},u.prototype.insertBuffer=function(t){for(var e=!0,i=0;i<this.buffers.length;i++){var s=this.buffers[i];if(t.fileStart<=s.fileStart){if(t.fileStart===s.fileStart)if(t.byteLength>s.byteLength){this.buffers.splice(i,1),i--;continue}else o.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring");else t.fileStart+t.byteLength<=s.fileStart||(t=this.reduceBuffer(t,0,s.fileStart-t.fileStart)),o.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(i,0,t),i===0&&(this.buffer=t);e=!1;break}else if(t.fileStart<s.fileStart+s.byteLength){var a=s.fileStart+s.byteLength-t.fileStart,d=t.byteLength-a;if(d>0)t=this.reduceBuffer(t,a,d);else{e=!1;break}}}e&&(o.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),i===0&&(this.buffer=t))},u.prototype.logBufferLevel=function(t){var e,i,s,a,d=[],p,g="";for(s=0,a=0,e=0;e<this.buffers.length;e++)i=this.buffers[e],e===0?(p={},d.push(p),p.start=i.fileStart,p.end=i.fileStart+i.byteLength,g+="["+p.start+"-"):p.end===i.fileStart?p.end=i.fileStart+i.byteLength:(p={},p.start=i.fileStart,g+=d[d.length-1].end-1+"], ["+p.start+"-",p.end=i.fileStart+i.byteLength,d.push(p)),s+=i.usedBytes,a+=i.byteLength;d.length>0&&(g+=p.end-1+"]");var y=t?o.info:o.debug;this.buffers.length===0?y("MultiBufferStream","No more buffer in memory"):y("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+s+"/"+a+" bytes), continuous ranges: "+g)},u.prototype.cleanBuffers=function(){var t,e;for(t=0;t<this.buffers.length;t++)e=this.buffers[t],e.usedBytes===e.byteLength&&(o.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)},u.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length)if(t=this.buffers[this.bufferIndex+1],t.fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,i=this.buffer.usedBytes,s=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=i,this.buffer.fileStart=s,o.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},u.prototype.findPosition=function(t,e,i){var s,a=null,d=-1;for(t===!0?s=0:s=this.bufferIndex;s<this.buffers.length&&(a=this.buffers[s],a.fileStart<=e);){d=s,i&&(a.fileStart+a.byteLength<=e?a.usedBytes=a.byteLength:a.usedBytes=e-a.fileStart,this.logBufferLevel());s++}return d!==-1?(a=this.buffers[d],a.fileStart+a.byteLength>=e?(o.debug("MultiBufferStream","Found position in existing buffer #"+d),d):-1):-1},u.prototype.findEndContiguousBuf=function(t){var e,i,s,a=t!==void 0?t:this.bufferIndex;if(i=this.buffers[a],this.buffers.length>a+1)for(e=a+1;e<this.buffers.length&&(s=this.buffers[e],s.fileStart===i.fileStart+i.byteLength);e++)i=s;return i.fileStart+i.byteLength},u.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return e!==-1?this.findEndContiguousBuf(e):t},u.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},u.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},u.prototype.seek=function(t,e,i){var s;return s=this.findPosition(e,t,i),s!==-1?(this.buffer=this.buffers[s],this.bufferIndex=s,this.position=t-this.buffer.fileStart,o.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(o.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},u.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},u.prototype.getLength=function(){return this.byteLength},u.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},n.MultiBufferStream=u;var c=function(){var t=3,e=4,i=5,s=6,a=[];a[t]="ES_Descriptor",a[e]="DecoderConfigDescriptor",a[i]="DecoderSpecificInfo",a[s]="SLConfigDescriptor",this.getDescriptorName=function(g){return a[g]};var d=this,p={};return this.parseOneDescriptor=function(g){var y=0,w,b,U;for(w=g.readUint8(),U=g.readUint8();U&128;)y=(U&127)<<7,U=g.readUint8();return y+=U&127,o.debug("MPEG4DescriptorParser","Found "+(a[w]||"Descriptor "+w)+", size "+y+" at position "+g.getPosition()),a[w]?b=new p[a[w]](y):b=new p.Descriptor(y),b.parse(g),b},p.Descriptor=function(g,y){this.tag=g,this.size=y,this.descs=[]},p.Descriptor.prototype.parse=function(g){this.data=g.readUint8Array(this.size)},p.Descriptor.prototype.findDescriptor=function(g){for(var y=0;y<this.descs.length;y++)if(this.descs[y].tag==g)return this.descs[y];return null},p.Descriptor.prototype.parseRemainingDescriptors=function(g){for(var y=g.position;g.position<y+this.size;){var w=d.parseOneDescriptor(g);this.descs.push(w)}},p.ES_Descriptor=function(g){p.Descriptor.call(this,t,g)},p.ES_Descriptor.prototype=new p.Descriptor,p.ES_Descriptor.prototype.parse=function(g){if(this.ES_ID=g.readUint16(),this.flags=g.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=g.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var y=g.readUint8();this.URL=g.readString(y),this.size-=y+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=g.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(g)},p.ES_Descriptor.prototype.getOTI=function(g){var y=this.findDescriptor(e);return y?y.oti:0},p.ES_Descriptor.prototype.getAudioConfig=function(g){var y=this.findDescriptor(e);if(!y)return null;var w=y.findDescriptor(i);if(w&&w.data){var b=(w.data[0]&248)>>3;return b===31&&w.data.length>=2&&(b=32+((w.data[0]&7)<<3)+((w.data[1]&224)>>5)),b}else return null},p.DecoderConfigDescriptor=function(g){p.Descriptor.call(this,e,g)},p.DecoderConfigDescriptor.prototype=new p.Descriptor,p.DecoderConfigDescriptor.prototype.parse=function(g){this.oti=g.readUint8(),this.streamType=g.readUint8(),this.bufferSize=g.readUint24(),this.maxBitrate=g.readUint32(),this.avgBitrate=g.readUint32(),this.size-=13,this.parseRemainingDescriptors(g)},p.DecoderSpecificInfo=function(g){p.Descriptor.call(this,i,g)},p.DecoderSpecificInfo.prototype=new p.Descriptor,p.SLConfigDescriptor=function(g){p.Descriptor.call(this,s,g)},p.SLConfigDescriptor.prototype=new p.Descriptor,this};n.MPEG4DescriptorParser=c;var r={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){r.FullBox.prototype=new r.Box,r.ContainerBox.prototype=new r.Box,r.SampleEntry.prototype=new r.Box,r.TrackGroupTypeBox.prototype=new r.FullBox,r.BASIC_BOXES.forEach(function(t){r.createBoxCtor(t)}),r.FULL_BOXES.forEach(function(t){r.createFullBoxCtor(t)}),r.CONTAINER_BOXES.forEach(function(t){r.createContainerBoxCtor(t[0],null,t[1])})},Box:function(t,e,i){this.type=t,this.size=e,this.uuid=i},FullBox:function(t,e,i){r.Box.call(this,t,e,i),this.flags=0,this.version=0},ContainerBox:function(t,e,i){r.Box.call(this,t,e,i),this.boxes=[]},SampleEntry:function(t,e,i,s){r.ContainerBox.call(this,t,e),this.hdr_size=i,this.start=s},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){r.FullBox.call(this,t,e)},createBoxCtor:function(t,e){r.boxCodes.push(t),r[t+"Box"]=function(i){r.Box.call(this,t,i)},r[t+"Box"].prototype=new r.Box,e&&(r[t+"Box"].prototype.parse=e)},createFullBoxCtor:function(t,e){r[t+"Box"]=function(i){r.FullBox.call(this,t,i)},r[t+"Box"].prototype=new r.FullBox,r[t+"Box"].prototype.parse=function(i){this.parseFullHeader(i),e&&e.call(this,i)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var e=t.length,i=0;i<e;i++)this[t[i]+"s"]=[]}},createContainerBoxCtor:function(t,e,i){r[t+"Box"]=function(s){r.ContainerBox.call(this,t,s),r.addSubBoxArrays.call(this,i)},r[t+"Box"].prototype=new r.ContainerBox,e&&(r[t+"Box"].prototype.parse=e)},createMediaSampleEntryCtor:function(t,e,i){r.sampleEntryCodes[t]=[],r[t+"SampleEntry"]=function(s,a){r.SampleEntry.call(this,s,a),r.addSubBoxArrays.call(this,i)},r[t+"SampleEntry"].prototype=new r.SampleEntry,e&&(r[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(t,e,i,s){r.sampleEntryCodes[t].push(e),r[e+"SampleEntry"]=function(a){r[t+"SampleEntry"].call(this,e,a),r.addSubBoxArrays.call(this,s)},r[e+"SampleEntry"].prototype=new r[t+"SampleEntry"],i&&(r[e+"SampleEntry"].prototype.parse=i)},createEncryptedSampleEntryCtor:function(t,e,i){r.createSampleEntryCtor.call(this,t,e,i,["sinf"])},createSampleGroupCtor:function(t,e){r[t+"SampleGroupEntry"]=function(i){r.SampleGroupEntry.call(this,t,i)},r[t+"SampleGroupEntry"].prototype=new r.SampleGroupEntry,e&&(r[t+"SampleGroupEntry"].prototype.parse=e)},createTrackGroupCtor:function(t,e){r[t+"TrackGroupTypeBox"]=function(i){r.TrackGroupTypeBox.call(this,t,i)},r[t+"TrackGroupTypeBox"].prototype=new r.TrackGroupTypeBox,e&&(r[t+"TrackGroupTypeBox"].prototype.parse=e)},createUUIDBox:function(t,e,i,s){r.UUIDs.push(t),r.UUIDBoxes[t]=function(a){e?r.FullBox.call(this,"uuid",a,t):i?r.ContainerBox.call(this,"uuid",a,t):r.Box.call(this,"uuid",a,t)},r.UUIDBoxes[t].prototype=e?new r.FullBox:i?new r.ContainerBox:new r.Box,s&&(e?r.UUIDBoxes[t].prototype.parse=function(a){this.parseFullHeader(a),s&&s.call(this,a)}:r.UUIDBoxes[t].prototype.parse=s)}};r.initialize(),r.TKHD_FLAG_ENABLED=1,r.TKHD_FLAG_IN_MOVIE=2,r.TKHD_FLAG_IN_PREVIEW=4,r.TFHD_FLAG_BASE_DATA_OFFSET=1,r.TFHD_FLAG_SAMPLE_DESC=2,r.TFHD_FLAG_SAMPLE_DUR=8,r.TFHD_FLAG_SAMPLE_SIZE=16,r.TFHD_FLAG_SAMPLE_FLAGS=32,r.TFHD_FLAG_DUR_EMPTY=65536,r.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,r.TRUN_FLAGS_DATA_OFFSET=1,r.TRUN_FLAGS_FIRST_FLAG=4,r.TRUN_FLAGS_DURATION=256,r.TRUN_FLAGS_SIZE=512,r.TRUN_FLAGS_FLAGS=1024,r.TRUN_FLAGS_CTS_OFFSET=2048,r.Box.prototype.add=function(t){return this.addBox(new r[t+"Box"])},r.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},r.Box.prototype.set=function(t,e){return this[t]=e,this},r.Box.prototype.addEntry=function(t,e){var i=e||"entries";return this[i]||(this[i]=[]),this[i].push(t),this},n.BoxParser=r,r.parseUUID=function(t){return r.parseHex16(t)},r.parseHex16=function(t){for(var e="",i=0;i<16;i++){var s=t.readUint8().toString(16);e+=s.length===1?"0"+s:s}return e},r.parseOneBox=function(t,e,i){var s,a=t.getPosition(),d=0,p,g;if(t.getEndPosition()-a<8)return o.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:r.ERR_NOT_ENOUGH_DATA};if(i&&i<8)return o.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:r.ERR_NOT_ENOUGH_DATA};var y=t.readUint32(),w=t.readString(4),b=w;if(o.debug("BoxParser","Found box of type '"+w+"' and size "+y+" at position "+a),d=8,w=="uuid"){if(t.getEndPosition()-t.getPosition()<16||i-d<16)return t.seek(a),o.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:r.ERR_NOT_ENOUGH_DATA};g=r.parseUUID(t),d+=16,b=g}if(y==1){if(t.getEndPosition()-t.getPosition()<8||i&&i-d<8)return t.seek(a),o.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+w+'" box'),{code:r.ERR_NOT_ENOUGH_DATA};y=t.readUint64(),d+=8}else if(y===0){if(i)y=i;else if(w!=="mdat")return o.error("BoxParser","Unlimited box size not supported for type: '"+w+"'"),s=new r.Box(w,y),{code:r.OK,box:s,size:s.size}}return y<d?(o.error("BoxParser","Box of type "+w+" has an invalid size "+y+" (too small to be a box)"),{code:r.ERR_NOT_ENOUGH_DATA,type:w,size:y,hdr_size:d,start:a}):i&&y>i?(o.error("BoxParser","Box of type '"+w+"' has a size "+y+" greater than its container size "+i),{code:r.ERR_NOT_ENOUGH_DATA,type:w,size:y,hdr_size:d,start:a}):a+y>t.getEndPosition()?(t.seek(a),o.info("BoxParser","Not enough data in stream to parse the entire '"+w+"' box"),{code:r.ERR_NOT_ENOUGH_DATA,type:w,size:y,hdr_size:d,start:a}):e?{code:r.OK,type:w,size:y,hdr_size:d,start:a}:(r[w+"Box"]?s=new r[w+"Box"](y):w!=="uuid"?(o.warn("BoxParser","Unknown box type: '"+w+"'"),s=new r.Box(w,y),s.has_unparsed_data=!0):r.UUIDBoxes[g]?s=new r.UUIDBoxes[g](y):(o.warn("BoxParser","Unknown uuid type: '"+g+"'"),s=new r.Box(w,y),s.uuid=g,s.has_unparsed_data=!0),s.hdr_size=d,s.start=a,s.write===r.Box.prototype.write&&s.type!=="mdat"&&(o.info("BoxParser","'"+b+"' box writing not yet implemented, keeping unparsed data in memory for later write"),s.parseDataAndRewind(t)),s.parse(t),p=t.getPosition()-(s.start+s.size),p<0?(o.warn("BoxParser","Parsing of box '"+b+"' did not read the entire indicated box data size (missing "+-p+" bytes), seeking forward"),t.seek(s.start+s.size)):p>0&&(o.error("BoxParser","Parsing of box '"+b+"' read "+p+" more bytes than the indicated box data size, seeking backwards"),t.seek(s.start+s.size)),{code:r.OK,box:s,size:s.size})},r.Box.prototype.parse=function(t){this.type!="mdat"?this.data=t.readUint8Array(this.size-this.hdr_size):this.size===0?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},r.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},r.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},r.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},r.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},r.ContainerBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;)if(e=r.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===r.OK)if(i=e.box,this.boxes.push(i),this.subBoxNames&&this.subBoxNames.indexOf(i.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(i.type)]+"s"].push(i);else{var s=i.type!=="uuid"?i.type:i.uuid;this[s]?o.warn("Box of type "+s+" already stored in field of this type"):this[s]=i}else return},r.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=this.language&31,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},r.SAMPLE_ENTRY_TYPE_VISUAL="Visual",r.SAMPLE_ENTRY_TYPE_AUDIO="Audio",r.SAMPLE_ENTRY_TYPE_HINT="Hint",r.SAMPLE_ENTRY_TYPE_METADATA="Metadata",r.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",r.SAMPLE_ENTRY_TYPE_SYSTEM="System",r.SAMPLE_ENTRY_TYPE_TEXT="Text",r.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},r.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},r.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},r.SampleEntry.prototype.parseFooter=function(t){r.ContainerBox.prototype.parse.call(this,t)},r.createMediaSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_HINT),r.createMediaSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_METADATA),r.createMediaSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SUBTITLE),r.createMediaSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SYSTEM),r.createMediaSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_TEXT),r.createMediaSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)}),r.createMediaSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),r.createEncryptedSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),r.createEncryptedSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),r.createEncryptedSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),r.createEncryptedSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),r.createEncryptedSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_TEXT,"enct"),r.createEncryptedSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_METADATA,"encm"),r.createBoxCtor("a1lx",function(t){var e=t.readUint8()&1,i=((e&1)+1)*16;this.layer_size=[];for(var s=0;s<3;s++)i==16?this.layer_size[s]=t.readUint16():this.layer_size[s]=t.readUint32()}),r.createBoxCtor("a1op",function(t){this.op_index=t.readUint8()}),r.createFullBoxCtor("auxC",function(t){this.aux_type=t.readCString();var e=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(e)}),r.createBoxCtor("av1C",function(t){var e=t.readUint8();if(e>>7&!1){o.error("av1C marker problem");return}if(this.version=e&127,this.version!==1){o.error("av1C version "+this.version+" not supported");return}if(e=t.readUint8(),this.seq_profile=e>>5&7,this.seq_level_idx_0=e&31,e=t.readUint8(),this.seq_tier_0=e>>7&1,this.high_bitdepth=e>>6&1,this.twelve_bit=e>>5&1,this.monochrome=e>>4&1,this.chroma_subsampling_x=e>>3&1,this.chroma_subsampling_y=e>>2&1,this.chroma_sample_position=e&3,e=t.readUint8(),this.reserved_1=e>>5&7,this.reserved_1!==0){o.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=e>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=e&15;else if(this.reserved_2=e&15,this.reserved_2!==0){o.error("av1C reserved_2 parsing problem");return}var i=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(i)}),r.createBoxCtor("avcC",function(t){var e,i;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=t.readUint8()&3,this.nb_SPS_nalus=t.readUint8()&31,i=this.size-this.hdr_size-6,this.SPS=[],e=0;e<this.nb_SPS_nalus;e++)this.SPS[e]={},this.SPS[e].length=t.readUint16(),this.SPS[e].nalu=t.readUint8Array(this.SPS[e].length),i-=2+this.SPS[e].length;for(this.nb_PPS_nalus=t.readUint8(),i--,this.PPS=[],e=0;e<this.nb_PPS_nalus;e++)this.PPS[e]={},this.PPS[e].length=t.readUint16(),this.PPS[e].nalu=t.readUint8Array(this.PPS[e].length),i-=2+this.PPS[e].length;i>0&&(this.ext=t.readUint8Array(i))}),r.createBoxCtor("btrt",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()}),r.createBoxCtor("clap",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()}),r.createBoxCtor("clli",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()}),r.createFullBoxCtor("co64",function(t){var e,i;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(i=0;i<e;i++)this.chunk_offsets.push(t.readUint64())}),r.createFullBoxCtor("CoLL",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()}),r.createBoxCtor("colr",function(t){if(this.colour_type=t.readString(4),this.colour_type==="nclx"){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var e=t.readUint8();this.full_range_flag=e>>7}else this.colour_type==="rICC"?this.ICC_profile=t.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=t.readUint8Array(this.size-4))}),r.createFullBoxCtor("cprt",function(t){this.parseLanguage(t),this.notice=t.readCString()}),r.createFullBoxCtor("cslg",function(t){this.version===0&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())}),r.createFullBoxCtor("ctts",function(t){var e,i;if(e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(i=0;i<e;i++){this.sample_counts.push(t.readUint32());var s=t.readInt32();s<0&&o.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(s)}else if(this.version==1)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())}),r.createBoxCtor("dac3",function(t){var e=t.readUint8(),i=t.readUint8(),s=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(e&1)<<2|i>>6&3,this.acmod=i>>3&7,this.lfeon=i>>2&1,this.bit_rate_code=i&3|s>>5&7}),r.createBoxCtor("dec3",function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=e&7,this.ind_subs=[];for(var i=0;i<this.num_ind_sub+1;i++){var s={};this.ind_subs.push(s);var a=t.readUint8(),d=t.readUint8(),p=t.readUint8();s.fscod=a>>6,s.bsid=a>>1&31,s.bsmod=(a&1)<<4|d>>4&15,s.acmod=d>>1&7,s.lfeon=d&1,s.num_dep_sub=p>>1&15,s.num_dep_sub>0&&(s.chan_loc=(p&1)<<8|t.readUint8())}}),r.createFullBoxCtor("dfLa",function(t){var e=127,i=128,s=[],a=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];this.parseFullHeader(t);do{var d=t.readUint8(),p=Math.min(d&e,a.length-1);if(p?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),s.push(a[p]),d&i)break}while(!0);this.numMetadataBlocks=s.length+" ("+s.join(", ")+")"}),r.createBoxCtor("dimm",function(t){this.bytessent=t.readUint64()}),r.createBoxCtor("dmax",function(t){this.time=t.readUint32()}),r.createBoxCtor("dmed",function(t){this.bytessent=t.readUint64()}),r.createFullBoxCtor("dref",function(t){var e,i;this.entries=[];for(var s=t.readUint32(),a=0;a<s;a++)if(e=r.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===r.OK)i=e.box,this.entries.push(i);else return}),r.createBoxCtor("drep",function(t){this.bytessent=t.readUint64()}),r.createFullBoxCtor("elng",function(t){this.extended_language=t.readString(this.size-this.hdr_size)}),r.createFullBoxCtor("elst",function(t){this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var s={};this.entries.push(s),this.version===1?(s.segment_duration=t.readUint64(),s.media_time=t.readInt64()):(s.segment_duration=t.readUint32(),s.media_time=t.readInt32()),s.media_rate_integer=t.readInt16(),s.media_rate_fraction=t.readInt16()}}),r.createFullBoxCtor("emsg",function(t){this.version==1?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(e-=4),this.message_data=t.readUint8Array(e)}),r.createFullBoxCtor("esds",function(t){var e=t.readUint8Array(this.size-this.hdr_size);if(typeof c<"u"){var i=new c;this.esd=i.parseOneDescriptor(new h(e.buffer,0,h.BIG_ENDIAN))}}),r.createBoxCtor("fiel",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()}),r.createBoxCtor("frma",function(t){this.data_format=t.readString(4)}),r.createBoxCtor("ftyp",function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var i=0;e>=4;)this.compatible_brands[i]=t.readString(4),e-=4,i++}),r.createFullBoxCtor("hdlr",function(t){this.version===0&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),r.createBoxCtor("hvcC",function(t){var e,i,s,a;this.configurationVersion=t.readUint8(),a=t.readUint8(),this.general_profile_space=a>>6,this.general_tier_flag=(a&32)>>5,this.general_profile_idc=a&31,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,this.chroma_format_idc=t.readUint8()&3,this.bit_depth_luma_minus8=t.readUint8()&7,this.bit_depth_chroma_minus8=t.readUint8()&7,this.avgFrameRate=t.readUint16(),a=t.readUint8(),this.constantFrameRate=a>>6,this.numTemporalLayers=(a&13)>>3,this.temporalIdNested=(a&4)>>2,this.lengthSizeMinusOne=a&3,this.nalu_arrays=[];var d=t.readUint8();for(e=0;e<d;e++){var p=[];this.nalu_arrays.push(p),a=t.readUint8(),p.completeness=(a&128)>>7,p.nalu_type=a&63;var g=t.readUint16();for(i=0;i<g;i++){var y={};p.push(y),s=t.readUint16(),y.data=t.readUint8Array(s)}}}),r.createFullBoxCtor("iinf",function(t){var e;this.version===0?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var i=0;i<this.entry_count;i++)if(e=r.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===r.OK)e.box.type!=="infe"&&o.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[i]=e.box;else return}),r.createFullBoxCtor("iloc",function(t){var e;e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=e&15,e=t.readUint8(),this.base_offset_size=e>>4&15,this.version===1||this.version===2?this.index_size=e&15:this.index_size=0,this.items=[];var i=0;if(this.version<2)i=t.readUint16();else if(this.version===2)i=t.readUint32();else throw"version of iloc box not supported";for(var s=0;s<i;s++){var a={};if(this.items.push(a),this.version<2)a.item_ID=t.readUint16();else if(this.version===2)a.item_ID=t.readUint16();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?a.construction_method=t.readUint16()&15:a.construction_method=0,a.data_reference_index=t.readUint16(),this.base_offset_size){case 0:a.base_offset=0;break;case 4:a.base_offset=t.readUint32();break;case 8:a.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var d=t.readUint16();a.extents=[];for(var p=0;p<d;p++){var g={};if(a.extents.push(g),this.version===1||this.version===2)switch(this.index_size){case 0:g.extent_index=0;break;case 4:g.extent_index=t.readUint32();break;case 8:g.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:g.extent_offset=0;break;case 4:g.extent_offset=t.readUint32();break;case 8:g.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:g.extent_length=0;break;case 4:g.extent_length=t.readUint32();break;case 8:g.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}}),r.createBoxCtor("imir",function(t){var e=t.readUint8();this.reserved=e>>7,this.axis=e&1}),r.createFullBoxCtor("infe",function(t){if((this.version===0||this.version===1)&&(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),this.version===1){this.extension_type=t.readString(4),o.warn("BoxParser","Cannot parse extension type"),t.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=t.readUint16():this.version===3&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),this.item_type==="mime"?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):this.item_type==="uri "&&(this.item_uri_type=t.readCString()))}),r.createFullBoxCtor("ipma",function(t){var e,i;for(entry_count=t.readUint32(),this.associations=[],e=0;e<entry_count;e++){var s={};this.associations.push(s),this.version<1?s.id=t.readUint16():s.id=t.readUint32();var a=t.readUint8();for(s.props=[],i=0;i<a;i++){var d=t.readUint8(),p={};s.props.push(p),p.essential=(d&128)>>7===1,this.flags&1?p.property_index=(d&127)<<8|t.readUint8():p.property_index=d&127}}}),r.createFullBoxCtor("iref",function(t){var e,i;for(this.references=[];t.getPosition()<this.start+this.size;)if(e=r.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===r.OK)this.version===0?i=new r.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):i=new r.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start),i.write===r.Box.prototype.write&&i.type!=="mdat"&&(o.warn("BoxParser",i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(t)),i.parse(t),this.references.push(i);else return}),r.createBoxCtor("irot",function(t){this.angle=t.readUint8()&3}),r.createFullBoxCtor("ispe",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()}),r.createFullBoxCtor("kind",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()}),r.createFullBoxCtor("leva",function(t){var e=t.readUint8();this.levels=[];for(var i=0;i<e;i++){var s={};this.levels[i]=s,s.track_ID=t.readUint32();var a=t.readUint8();switch(s.padding_flag=a>>7,s.assignment_type=a&127,s.assignment_type){case 0:s.grouping_type=t.readString(4);break;case 1:s.grouping_type=t.readString(4),s.grouping_type_parameter=t.readUint32();break;case 2:break;case 3:break;case 4:s.sub_track_id=t.readUint32();break;default:o.warn("BoxParser","Unknown leva assignement type")}}}),r.createBoxCtor("lsel",function(t){this.layer_id=t.readUint16()}),r.createBoxCtor("maxr",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()}),r.createBoxCtor("mdcv",function(t){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=t.readUint16(),this.display_primaries[0].y=t.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=t.readUint16(),this.display_primaries[1].y=t.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=t.readUint16(),this.display_primaries[2].y=t.readUint16(),this.white_point={},this.white_point.x=t.readUint16(),this.white_point.y=t.readUint16(),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()}),r.createFullBoxCtor("mdhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()}),r.createFullBoxCtor("mehd",function(t){this.flags&1&&(o.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()}),r.createFullBoxCtor("meta",function(t){this.boxes=[],r.ContainerBox.prototype.parse.call(this,t)}),r.createFullBoxCtor("mfhd",function(t){this.sequence_number=t.readUint32()}),r.createFullBoxCtor("mfro",function(t){this._size=t.readUint32()}),r.createFullBoxCtor("mvhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()}),r.createBoxCtor("npck",function(t){this.packetssent=t.readUint32()}),r.createBoxCtor("nump",function(t){this.packetssent=t.readUint64()}),r.createFullBoxCtor("padb",function(t){var e=t.readUint32();this.padbits=[];for(var i=0;i<Math.floor((e+1)/2);i++)this.padbits=t.readUint8()}),r.createBoxCtor("pasp",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()}),r.createBoxCtor("payl",function(t){this.text=t.readString(this.size-this.hdr_size)}),r.createBoxCtor("payt",function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)}),r.createFullBoxCtor("pdin",function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var i=0;i<e;i++)this.rate[i]=t.readUint32(),this.initial_delay[i]=t.readUint32()}),r.createFullBoxCtor("pitm",function(t){this.version===0?this.item_id=t.readUint16():this.item_id=t.readUint32()}),r.createFullBoxCtor("pixi",function(t){var e;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],e=0;e<this.num_channels;e++)this.bits_per_channels[e]=t.readUint8()}),r.createBoxCtor("pmax",function(t){this.bytes=t.readUint32()}),r.createFullBoxCtor("prft",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),this.version===0?this.media_time=t.readUint32():this.media_time=t.readUint64()}),r.createFullBoxCtor("pssh",function(t){if(this.system_id=r.parseHex16(t),this.version>0){var e=t.readUint32();this.kid=[];for(var i=0;i<e;i++)this.kid[i]=r.parseHex16(t)}var s=t.readUint32();s>0&&(this.data=t.readUint8Array(s))}),r.createFullBoxCtor("clef",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),r.createFullBoxCtor("enof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),r.createFullBoxCtor("prof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),r.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),r.createBoxCtor("rtp ",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)}),r.createFullBoxCtor("saio",function(t){this.flags&1&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var i=0;i<e;i++)this.version===0?this.offset[i]=t.readUint32():this.offset[i]=t.readUint64()}),r.createFullBoxCtor("saiz",function(t){this.flags&1&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8();var e=t.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var i=0;i<e;i++)this.sample_info_size[i]=t.readUint8()}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)}),r.createSampleEntryCtor(r.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)}),r.createSampleGroupCtor("alst",function(t){var e,i=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<i;e++)this.sample_offset[e]=t.readUint32();var s=this.description_length-4-4*i;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<s/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()}),r.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()}),r.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var i=t.readUint8(),s=0;s<i;s++){var a={};this.dependency.push(a),a.subSeqDirectionFlag=t.readUint8(),a.layerNumber=t.readUint8(),a.subSequenceIdentifier=t.readUint16()}}),r.createSampleGroupCtor("dtrt",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createSampleGroupCtor("mvif",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()}),r.createSampleGroupCtor("rap ",function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=e&127}),r.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)o.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}}),r.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()}),r.SampleGroupEntry.prototype.parse=function(t){o.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},r.createSampleGroupCtor("scif",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createSampleGroupCtor("scnm",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=e&15,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=r.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))}),r.createSampleGroupCtor("stsa",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createSampleGroupCtor("sync",function(t){var e=t.readUint8();this.NAL_unit_type=e&63}),r.createSampleGroupCtor("tele",function(t){var e=t.readUint8();this.level_independently_decodable=e>>7}),r.createSampleGroupCtor("tsas",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createSampleGroupCtor("tscl",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createSampleGroupCtor("vipr",function(t){o.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),r.createFullBoxCtor("sbgp",function(t){this.grouping_type=t.readString(4),this.version===1?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var s={};this.entries.push(s),s.sample_count=t.readInt32(),s.group_description_index=t.readInt32()}}),r.createFullBoxCtor("schm",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),this.flags&1&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))}),r.createBoxCtor("sdp ",function(t){this.sdptext=t.readString(this.size-this.hdr_size)}),r.createFullBoxCtor("sdtp",function(t){var e,i=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var s=0;s<i;s++)e=t.readUint8(),this.is_leading[s]=e>>6,this.sample_depends_on[s]=e>>4&3,this.sample_is_depended_on[s]=e>>2&3,this.sample_has_redundancy[s]=e&3}),r.createFullBoxCtor("senc"),r.createFullBoxCtor("sgpd",function(t){this.grouping_type=t.readString(4),o.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var s;r[this.grouping_type+"SampleGroupEntry"]?s=new r[this.grouping_type+"SampleGroupEntry"](this.grouping_type):s=new r.SampleGroupEntry(this.grouping_type),this.entries.push(s),this.version===1?this.default_length===0?s.description_length=t.readUint32():s.description_length=this.default_length:s.description_length=this.default_length,s.write===r.SampleGroupEntry.prototype.write&&(o.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),s.data=t.readUint8Array(s.description_length),t.position-=s.description_length),s.parse(t)}}),r.createFullBoxCtor("sidx",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),this.version===0?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),i=0;i<e;i++){var s={};this.references.push(s);var a=t.readUint32();s.reference_type=a>>31&1,s.referenced_size=a&2147483647,s.subsegment_duration=t.readUint32(),a=t.readUint32(),s.starts_with_SAP=a>>31&1,s.SAP_type=a>>28&7,s.SAP_delta_time=a&268435455}}),r.SingleItemTypeReferenceBox=function(t,e,i,s){r.Box.call(this,t,e),this.hdr_size=i,this.start=s},r.SingleItemTypeReferenceBox.prototype=new r.Box,r.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint16()},r.SingleItemTypeReferenceBoxLarge=function(t,e,i,s){r.Box.call(this,t,e),this.hdr_size=i,this.start=s},r.SingleItemTypeReferenceBoxLarge.prototype=new r.Box,r.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint32()},r.createFullBoxCtor("SmDm",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()}),r.createFullBoxCtor("smhd",function(t){this.balance=t.readUint16(),t.readUint16()}),r.createFullBoxCtor("ssix",function(t){this.subsegments=[];for(var e=t.readUint32(),i=0;i<e;i++){var s={};this.subsegments.push(s),s.ranges=[];for(var a=t.readUint32(),d=0;d<a;d++){var p={};s.ranges.push(p),p.level=t.readUint8(),p.range_size=t.readUint24()}}}),r.createFullBoxCtor("stco",function(t){var e;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(var i=0;i<e;i++)this.chunk_offsets.push(t.readUint32())}),r.createFullBoxCtor("stdp",function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var i=0;i<e;i++)this.priority[i]=t.readUint16()}),r.createFullBoxCtor("sthd"),r.createFullBoxCtor("stri",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()}),r.createFullBoxCtor("stsc",function(t){var e,i;if(e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(i=0;i<e;i++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())}),r.createFullBoxCtor("stsd",function(t){var e,i,s,a;for(this.entries=[],s=t.readUint32(),e=1;e<=s;e++)if(i=r.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),i.code===r.OK)r[i.type+"SampleEntry"]?(a=new r[i.type+"SampleEntry"](i.size),a.hdr_size=i.hdr_size,a.start=i.start):(o.warn("BoxParser","Unknown sample entry type: "+i.type),a=new r.SampleEntry(i.type,i.size,i.hdr_size,i.start)),a.write===r.SampleEntry.prototype.write&&(o.info("BoxParser","SampleEntry "+a.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),a.parseDataAndRewind(t)),a.parse(t),this.entries.push(a);else return}),r.createFullBoxCtor("stsg",function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var i=0;i<e;i++)this.group_description_index[i]=t.readUint32()}),r.createFullBoxCtor("stsh",function(t){var e,i;if(e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(i=0;i<e;i++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())}),r.createFullBoxCtor("stss",function(t){var e,i;if(i=t.readUint32(),this.version===0)for(this.sample_numbers=[],e=0;e<i;e++)this.sample_numbers.push(t.readUint32())}),r.createFullBoxCtor("stsz",function(t){var e;if(this.sample_sizes=[],this.version===0)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),e=0;e<this.sample_count;e++)this.sample_size===0?this.sample_sizes.push(t.readUint32()):this.sample_sizes[e]=this.sample_size}),r.createFullBoxCtor("stts",function(t){var e,i,s;if(e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),s=t.readInt32(),s<0&&(o.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),s=1),this.sample_deltas.push(s)}),r.createFullBoxCtor("stvi",function(t){var e=t.readUint32();this.single_view_allowed=e&3,this.stereo_scheme=t.readUint32();var i=t.readUint32();this.stereo_indication_type=t.readString(i);var s,a;for(this.boxes=[];t.getPosition()<this.start+this.size;)if(s=r.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),s.code===r.OK)a=s.box,this.boxes.push(a),this[a.type]=a;else return}),r.createBoxCtor("styp",function(t){r.ftypBox.prototype.parse.call(this,t)}),r.createFullBoxCtor("stz2",function(t){var e,i;if(this.sample_sizes=[],this.version===0)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),i=t.readUint32(),this.field_size===4)for(e=0;e<i;e+=2){var s=t.readUint8();this.sample_sizes[e]=s>>4&15,this.sample_sizes[e+1]=s&15}else if(this.field_size===8)for(e=0;e<i;e++)this.sample_sizes[e]=t.readUint8();else if(this.field_size===16)for(e=0;e<i;e++)this.sample_sizes[e]=t.readUint16();else o.error("BoxParser","Error in length field in stz2 box")}),r.createFullBoxCtor("subs",function(t){var e,i,s,a;for(s=t.readUint32(),this.entries=[],e=0;e<s;e++){var d={};if(this.entries[e]=d,d.sample_delta=t.readUint32(),d.subsamples=[],a=t.readUint16(),a>0)for(i=0;i<a;i++){var p={};d.subsamples.push(p),this.version==1?p.size=t.readUint32():p.size=t.readUint16(),p.priority=t.readUint8(),p.discardable=t.readUint8(),p.codec_specific_parameters=t.readUint32()}}}),r.createFullBoxCtor("tenc",function(t){if(t.readUint8(),this.version===0)t.readUint8();else{var e=t.readUint8();this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=e&15}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=r.parseHex16(t),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))}),r.createFullBoxCtor("tfdt",function(t){this.version==1?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),r.createFullBoxCtor("tfhd",function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&r.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&r.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&r.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&r.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&r.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0}),r.createFullBoxCtor("tfra",function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=e&3,this.entries=[];for(var i=t.readUint32(),s=0;s<i;s++)this.version===1?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()}),r.createFullBoxCtor("tkhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),r.createBoxCtor("tmax",function(t){this.time=t.readUint32()}),r.createBoxCtor("tmin",function(t){this.time=t.readUint32()}),r.createBoxCtor("totl",function(t){this.bytessent=t.readUint32()}),r.createBoxCtor("tpay",function(t){this.bytessent=t.readUint32()}),r.createBoxCtor("tpyl",function(t){this.bytessent=t.readUint64()}),r.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},r.createTrackGroupCtor("msrc"),r.TrackReferenceTypeBox=function(t,e,i,s){r.Box.call(this,t,e),this.hdr_size=i,this.start=s},r.TrackReferenceTypeBox.prototype=new r.Box,r.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},r.trefBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;)if(e=r.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===r.OK)i=new r.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start),i.write===r.Box.prototype.write&&i.type!=="mdat"&&(o.info("BoxParser","TrackReference "+i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(t)),i.parse(t),this.boxes.push(i);else return},r.createFullBoxCtor("trep",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;)if(ret=r.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code===r.OK)box=ret.box,this.boxes.push(box);else return}),r.createFullBoxCtor("trex",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()}),r.createBoxCtor("trpy",function(t){this.bytessent=t.readUint64()}),r.createFullBoxCtor("trun",function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&r.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&r.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var i=0;i<this.sample_count;i++)this.flags&r.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=t.readUint32()),this.flags&r.TRUN_FLAGS_SIZE&&(this.sample_size[i]=t.readUint32()),this.flags&r.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=t.readUint32()),this.flags&r.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[i]=t.readUint32():this.sample_composition_time_offset[i]=t.readInt32())}),r.createFullBoxCtor("tsel",function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()}),r.createFullBoxCtor("txtC",function(t){this.config=t.readCString()}),r.createFullBoxCtor("url ",function(t){this.flags!==1&&(this.location=t.readCString())}),r.createFullBoxCtor("urn ",function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())}),r.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),r.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(t){this.system_id=r.parseHex16(t);var e=t.readUint32();e>0&&(this.data=t.readUint8Array(e))}),r.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),r.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=r.parseHex16(t)}),r.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var e=0;e<this.fragment_count;e++){var i={},s=0,a=0;this.version===1?(s=t.readUint64(),a=t.readUint64()):(s=t.readUint32(),a=t.readUint32()),i.absolute_time=s,i.absolute_duration=a,this.entries.push(i)}}),r.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(t){this.version===1?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())}),r.createFullBoxCtor("vmhd",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)}),r.createFullBoxCtor("vpcC",function(t){var e;this.version===1?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=e&1,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=e&15,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=e&1,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))}),r.createBoxCtor("vttC",function(t){this.text=t.readString(this.size-this.hdr_size)}),r.SampleEntry.prototype.isVideo=function(){return!1},r.SampleEntry.prototype.isAudio=function(){return!1},r.SampleEntry.prototype.isSubtitle=function(){return!1},r.SampleEntry.prototype.isMetadata=function(){return!1},r.SampleEntry.prototype.isHint=function(){return!1},r.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},r.SampleEntry.prototype.getWidth=function(){return""},r.SampleEntry.prototype.getHeight=function(){return""},r.SampleEntry.prototype.getChannelCount=function(){return""},r.SampleEntry.prototype.getSampleRate=function(){return""},r.SampleEntry.prototype.getSampleSize=function(){return""},r.VisualSampleEntry.prototype.isVideo=function(){return!0},r.VisualSampleEntry.prototype.getWidth=function(){return this.width},r.VisualSampleEntry.prototype.getHeight=function(){return this.height},r.AudioSampleEntry.prototype.isAudio=function(){return!0},r.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},r.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},r.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},r.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},r.MetadataSampleEntry.prototype.isMetadata=function(){return!0},r.decimalToHex=function(t,e){var i=Number(t).toString(16);for(e=typeof e>"u"||e===null?e=2:e;i.length<e;)i="0"+i;return i},r.avc1SampleEntry.prototype.getCodec=r.avc2SampleEntry.prototype.getCodec=r.avc3SampleEntry.prototype.getCodec=r.avc4SampleEntry.prototype.getCodec=function(){var t=r.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+r.decimalToHex(this.avcC.AVCProfileIndication)+r.decimalToHex(this.avcC.profile_compatibility)+r.decimalToHex(this.avcC.AVCLevelIndication):t},r.hev1SampleEntry.prototype.getCodec=r.hvc1SampleEntry.prototype.getCodec=function(){var t,e=r.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(e+=".",this.hvcC.general_profile_space){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C";break}e+=this.hvcC.general_profile_idc,e+=".";var i=this.hvcC.general_profile_compatibility,s=0;for(t=0;t<32&&(s|=i&1,t!=31);t++)s<<=1,i>>=1;e+=r.decimalToHex(s,0),e+=".",this.hvcC.general_tier_flag===0?e+="L":e+="H",e+=this.hvcC.general_level_idc;var a=!1,d="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||a)&&(d="."+r.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+d,a=!0);e+=d}return e},r.mp4aSampleEntry.prototype.getCodec=function(){var t=r.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),i=this.esds.esd.getAudioConfig();return t+"."+r.decimalToHex(e)+(i?"."+i:"")}else return t},r.stxtSampleEntry.prototype.getCodec=function(){var t=r.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},r.av01SampleEntry.prototype.getCodec=function(){var t=r.SampleEntry.prototype.getCodec.call(this),e;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?e=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(e=this.av1C.high_bitdepth===1?"10":"08"),t+"."+this.av1C.seq_profile+"."+this.av1C.seq_level_idx_0+(this.av1C.seq_tier_0?"H":"M")+"."+e},r.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>f&&(this.size+=8),this.type==="uuid"&&(this.size+=16),o.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>f?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),this.type==="uuid"&&t.writeUint8Array(this.uuid),this.size>f&&t.writeUint64(this.size)},r.FullBox.prototype.writeHeader=function(t){this.size+=4,r.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},r.Box.prototype.write=function(t){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},r.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);o.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},r.TrackReferenceTypeBox.prototype.write=function(t){this.size=this.track_ids.length*4,this.writeHeader(t),t.writeUint32Array(this.track_ids)},r.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e].nalu);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e].nalu);this.ext&&t.writeUint8Array(this.ext)},r.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])},r.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},r.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),this.version===1?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])},r.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;o.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},r.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},r.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeUint32(i.segment_duration),t.writeInt32(i.media_time),t.writeInt16(i.media_rate_integer),t.writeInt16(i.media_rate_fraction)}},r.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},r.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)},r.hdlrBox.prototype.write=function(t){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},r.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},r.mdhdBox.prototype.write=function(t){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},r.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},r.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},r.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},r.SampleEntry.prototype.writeHeader=function(t){this.size=8,r.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},r.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;o.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},r.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,o.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},r.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*7+6*4+32,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},r.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*4+3*4,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},r.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},r.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},r.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeInt32(i.sample_count),t.writeInt32(i.group_description_index)}},r.sgpdBox.prototype.write=function(t){var e,i;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)i=this.entries[e],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=i.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),this.version===1&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)i=this.entries[e],this.version===1&&this.default_length===0&&t.writeUint32(i.description_length),i.write(t)},r.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var i=this.references[e];t.writeUint32(i.reference_type<<31|i.referenced_size),t.writeUint32(i.subsegment_duration),t.writeUint32(i.starts_with_SAP<<31|i.SAP_type<<28|i.SAP_delta_time)}},r.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},r.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])},r.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;o.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},r.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])},r.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},r.stszBox.prototype.write=function(t){var e,i=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(e=0;e+1<this.sample_sizes.length;)if(this.sample_sizes[e+1]!==this.sample_sizes[0]){i=!1;break}else e++;else i=!1;this.size=8,i||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),i?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),i||t.writeUint32Array(this.sample_sizes)},r.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])},r.tfdtBox.prototype.write=function(t){var e=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>e?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(t),this.version===1?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},r.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&r.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&r.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&r.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&r.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&r.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&r.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&r.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&r.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&r.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&r.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},r.tkhdBox.prototype.write=function(t){this.version=0,this.size=4*18+2*4,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},r.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},r.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&r.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&r.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&r.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&r.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&r.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&r.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&r.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&r.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&r.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&r.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&r.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&r.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))},r["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},r["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},r.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},r.cttsBox.prototype.unpack=function(t){var e,i,s;for(s=0,e=0;e<this.sample_counts.length;e++)for(i=0;i<this.sample_counts[e];i++)t[s].pts=t[s].dts+this.sample_offsets[e],s++},r.sttsBox.prototype.unpack=function(t){var e,i,s;for(s=0,e=0;e<this.sample_counts.length;e++)for(i=0;i<this.sample_counts[e];i++)s===0?t[s].dts=0:t[s].dts=t[s-1].dts+this.sample_deltas[e],s++},r.stcoBox.prototype.unpack=function(t){var e;for(e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]},r.stscBox.prototype.unpack=function(t){var e,i,s,a,d;for(a=0,d=0,e=0;e<this.first_chunk.length;e++)for(i=0;i<(e+1<this.first_chunk.length?this.first_chunk[e+1]:1/0);i++)for(d++,s=0;s<this.samples_per_chunk[e];s++){if(t[a])t[a].description_index=this.sample_description_index[e],t[a].chunk_index=d;else return;a++}},r.stszBox.prototype.unpack=function(t){var e;for(e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]},r.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],r.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],r.boxEqualFields=function(t,e){if(t&&!e)return!1;var i;for(i in t)if(!(r.DIFF_BOXES_PROP_NAMES.indexOf(i)>-1)){if(t[i]instanceof r.Box||e[i]instanceof r.Box)continue;if(typeof t[i]>"u"||typeof e[i]>"u")continue;if(typeof t[i]=="function"||typeof e[i]=="function")continue;if(t.subBoxNames&&t.subBoxNames.indexOf(i.slice(0,4))>-1||e.subBoxNames&&e.subBoxNames.indexOf(i.slice(0,4))>-1)continue;if(i==="data"||i==="start"||i==="size"||i==="creation_time"||i==="modification_time")continue;if(r.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(i)>-1)continue;if(t[i]!==e[i])return!1}return!0},r.boxEqual=function(t,e){if(!r.boxEqualFields(t,e))return!1;for(var i=0;i<r.DIFF_BOXES_PROP_NAMES.length;i++){var s=r.DIFF_BOXES_PROP_NAMES[i];if(t[s]&&e[s]&&!r.boxEqual(t[s],e[s]))return!1}return!0};var m=function(){};m.prototype.parseSample=function(t){var e={},i;e.resources=[];var s=new l(t.data.buffer);if(!t.subsamples||t.subsamples.length===0)e.documentString=s.readString(t.data.length);else if(e.documentString=s.readString(t.subsamples[0].size),t.subsamples.length>1)for(i=1;i<t.subsamples.length;i++)e.resources[i]=s.readUint8Array(t.subsamples[i].size);return typeof DOMParser<"u"&&(e.document=new DOMParser().parseFromString(e.documentString,"application/xml")),e};var v=function(){};v.prototype.parseSample=function(t){var e,i=new l(t.data.buffer);return e=i.readString(t.data.length),e},v.prototype.parseConfig=function(t){var e,i=new l(t.buffer);return i.readUint32(),e=i.readCString(),e},n.XMLSubtitlein4Parser=m,n.Textin4Parser=v;var _=function(t){this.stream=t||new u,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};_.prototype.setSegmentOptions=function(t,e,i){var s=this.getTrackById(t);if(s){var a={};this.fragmentedTracks.push(a),a.id=t,a.user=e,a.trak=s,s.nextSample=0,a.segmentStream=null,a.nb_samples=1e3,a.rapAlignement=!0,i&&(i.nbSamples&&(a.nb_samples=i.nbSamples),i.rapAlignement&&(a.rapAlignement=i.rapAlignement))}},_.prototype.unsetSegmentOptions=function(t){for(var e=-1,i=0;i<this.fragmentedTracks.length;i++){var s=this.fragmentedTracks[i];s.id==t&&(e=i)}e>-1&&this.fragmentedTracks.splice(e,1)},_.prototype.setExtractionOptions=function(t,e,i){var s=this.getTrackById(t);if(s){var a={};this.extractedTracks.push(a),a.id=t,a.user=e,a.trak=s,s.nextSample=0,a.nb_samples=1e3,a.samples=[],i&&i.nbSamples&&(a.nb_samples=i.nbSamples)}},_.prototype.unsetExtractionOptions=function(t){for(var e=-1,i=0;i<this.extractedTracks.length;i++){var s=this.extractedTracks[i];s.id==t&&(e=i)}e>-1&&this.extractedTracks.splice(e,1)},_.prototype.parse=function(){var t,e,i=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),t=r.parseOneBox(this.stream,i),t.code===r.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}else return;else{var s;switch(e=t.box,s=e.type!=="uuid"?e.type:e.uuid,this.boxes.push(e),s){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[s]!==void 0&&o.warn("ISOFile","Duplicate Box of type: "+s+", overriding previous occurrence"),this[s]=e;break}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},_.prototype.checkBuffer=function(t){if(t==null)throw"Buffer must be defined and non empty";if(t.fileStart===void 0)throw"Buffer must have a fileStart property";return t.byteLength===0?(o.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(o.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),this.stream.initialized()?!0:(o.warn("ISOFile","Not ready to start parsing"),!1))},_.prototype.appendBuffer=function(t,e){var i;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(i=this.nextSeekPosition,this.nextSeekPosition=void 0):i=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(i=this.stream.getEndFilePositionAfter(i))):this.nextParsePosition?i=this.nextParsePosition:i=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(o.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+i),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),o.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),i},_.prototype.getInfo=function(){var t,e,i={},s,a,d,p=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(i.hasMoov=!0,i.duration=this.moov.mvhd.duration,i.timescale=this.moov.mvhd.timescale,i.isFragmented=this.moov.mvex!=null,i.isFragmented&&this.moov.mvex.mehd&&(i.fragment_duration=this.moov.mvex.mehd.fragment_duration),i.isProgressive=this.isProgressive,i.hasIOD=this.moov.iods!=null,i.brands=[],i.brands.push(this.ftyp.major_brand),i.brands=i.brands.concat(this.ftyp.compatible_brands),i.created=new Date(p+this.moov.mvhd.creation_time*1e3),i.modified=new Date(p+this.moov.mvhd.modification_time*1e3),i.tracks=[],i.audioTracks=[],i.videoTracks=[],i.subtitleTracks=[],i.metadataTracks=[],i.hintTracks=[],i.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(s=this.moov.traks[t],d=s.mdia.minf.stbl.stsd.entries[0],a={},i.tracks.push(a),a.id=s.tkhd.track_id,a.name=s.mdia.hdlr.name,a.references=[],s.tref)for(e=0;e<s.tref.boxes.length;e++)ref={},a.references.push(ref),ref.type=s.tref.boxes[e].type,ref.track_ids=s.tref.boxes[e].track_ids;s.edts&&(a.edits=s.edts.elst.entries),a.created=new Date(p+s.tkhd.creation_time*1e3),a.modified=new Date(p+s.tkhd.modification_time*1e3),a.movie_duration=s.tkhd.duration,a.movie_timescale=i.timescale,a.layer=s.tkhd.layer,a.alternate_group=s.tkhd.alternate_group,a.volume=s.tkhd.volume,a.matrix=s.tkhd.matrix,a.track_width=s.tkhd.width/65536,a.track_height=s.tkhd.height/65536,a.timescale=s.mdia.mdhd.timescale,a.cts_shift=s.mdia.minf.stbl.cslg,a.duration=s.mdia.mdhd.duration,a.samples_duration=s.samples_duration,a.codec=d.getCodec(),a.kind=s.udta&&s.udta.kinds.length?s.udta.kinds[0]:{schemeURI:"",value:""},a.language=s.mdia.elng?s.mdia.elng.extended_language:s.mdia.mdhd.languageString,a.nb_samples=s.samples.length,a.size=s.samples_size,a.bitrate=a.size*8*a.timescale/a.samples_duration,d.isAudio()?(a.type="audio",i.audioTracks.push(a),a.audio={},a.audio.sample_rate=d.getSampleRate(),a.audio.channel_count=d.getChannelCount(),a.audio.sample_size=d.getSampleSize()):d.isVideo()?(a.type="video",i.videoTracks.push(a),a.video={},a.video.width=d.getWidth(),a.video.height=d.getHeight()):d.isSubtitle()?(a.type="subtitles",i.subtitleTracks.push(a)):d.isHint()?(a.type="metadata",i.hintTracks.push(a)):d.isMetadata()?(a.type="metadata",i.metadataTracks.push(a)):(a.type="metadata",i.otherTracks.push(a))}else i.hasMoov=!1;if(i.mime="",i.hasMoov&&i.tracks){for(i.videoTracks&&i.videoTracks.length>0?i.mime+='video/mp4; codecs="':i.audioTracks&&i.audioTracks.length>0?i.mime+='audio/mp4; codecs="':i.mime+='application/mp4; codecs="',t=0;t<i.tracks.length;t++)t!==0&&(i.mime+=","),i.mime+=i.tracks[t].codec;i.mime+='"; profiles="',i.mime+=this.ftyp.compatible_brands.join(),i.mime+='"'}return i},_.prototype.processSamples=function(t){var e,i;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(e=0;e<this.fragmentedTracks.length;e++){var s=this.fragmentedTracks[e];for(i=s.trak;i.nextSample<i.samples.length&&this.sampleProcessingStarted;){o.debug("ISOFile","Creating media fragment on track #"+s.id+" for sample "+i.nextSample);var a=this.createFragment(s.id,i.nextSample,s.segmentStream);if(a)s.segmentStream=a,i.nextSample++;else break;if((i.nextSample%s.nb_samples===0||t||i.nextSample>=i.samples.length)&&(o.info("ISOFile","Sending fragmented data on track #"+s.id+" for samples ["+Math.max(0,i.nextSample-s.nb_samples)+","+(i.nextSample-1)+"]"),o.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(s.id,s.user,s.segmentStream.buffer,i.nextSample,t||i.nextSample>=i.samples.length),s.segmentStream=null,s!==this.fragmentedTracks[e]))break}}if(this.onSamples!==null)for(e=0;e<this.extractedTracks.length;e++){var d=this.extractedTracks[e];for(i=d.trak;i.nextSample<i.samples.length&&this.sampleProcessingStarted;){o.debug("ISOFile","Exporting on track #"+d.id+" sample #"+i.nextSample);var p=this.getSample(i,i.nextSample);if(p)i.nextSample++,d.samples.push(p);else break;if((i.nextSample%d.nb_samples===0||i.nextSample>=i.samples.length)&&(o.debug("ISOFile","Sending samples on track #"+d.id+" for sample "+i.nextSample),this.onSamples&&this.onSamples(d.id,d.user,d.samples),d.samples=[],d!==this.extractedTracks[e]))break}}}},_.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},_.prototype.getBoxes=function(t,e){var i=[];return _._sweep.call(this,t,i,e),i},_._sweep=function(t,e,i){this.type&&this.type==t&&e.push(this);for(var s in this.boxes){if(e.length&&i)return;_._sweep.call(this.boxes[s],t,e,i)}},_.prototype.getTrackSamplesInfo=function(t){var e=this.getTrackById(t);if(e)return e.samples},_.prototype.getTrackSample=function(t,e){var i=this.getTrackById(t),s=this.getSample(i,e);return s},_.prototype.releaseUsedSamples=function(t,e){var i=0,s=this.getTrackById(t);s.lastValidSample||(s.lastValidSample=0);for(var a=s.lastValidSample;a<e;a++)i+=this.releaseSample(s,a);o.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+i+", remaining: "+this.samplesDataSize+")"),s.lastValidSample=e},_.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},_.prototype.stop=function(){this.sampleProcessingStarted=!1},_.prototype.flush=function(){o.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},_.prototype.seekTrack=function(t,e,i){var s,a,d=1/0,p=0,g=0,y;if(i.samples.length===0)return o.info("ISOFile","No sample in track, cannot seek! Using time "+o.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(s=0;s<i.samples.length;s++){if(a=i.samples[s],s===0)g=0,y=a.timescale;else if(a.cts>t*a.timescale){g=s-1;break}e&&a.is_sync&&(p=s)}for(e&&(g=p),t=i.samples[g].cts,i.nextSample=g;i.samples[g].alreadyRead===i.samples[g].size&&i.samples[g+1];)g++;return d=i.samples[g].offset+i.samples[g].alreadyRead,o.info("ISOFile","Seeking to "+(e?"RAP":"")+" sample #"+i.nextSample+" on track "+i.tkhd.track_id+", time "+o.getDurationString(t,y)+" and offset: "+d),{offset:d,time:t/y}},_.prototype.seek=function(t,e){var i=this.moov,s,a,d,p={offset:1/0,time:1/0};if(this.moov){for(d=0;d<i.traks.length;d++)s=i.traks[d],a=this.seekTrack(t,e,s),a.offset<p.offset&&(p.offset=a.offset),a.time<p.time&&(p.time=a.time);return o.info("ISOFile","Seeking at time "+o.getDurationString(p.time,1)+" needs a buffer with a fileStart position of "+p.offset),p.offset===1/0?p={offset:this.nextParsePosition,time:0}:p.offset=this.stream.getEndFilePositionAfter(p.offset),o.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+p.offset),p}else throw"Cannot seek: moov not received!"},_.prototype.equal=function(t){for(var e=0;e<this.boxes.length&&e<t.boxes.length;){var i=this.boxes[e],s=t.boxes[e];if(!r.boxEqual(i,s))return!1;e++}return!0},n.ISOFile=_,_.prototype.lastBoxStartPosition=0,_.prototype.parsingMdat=null,_.prototype.nextParsePosition=0,_.prototype.discardMdatData=!1,_.prototype.processIncompleteBox=function(t){var e,i,s;return t.type==="mdat"?(e=new r[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,s=this.stream.seek(e.start+e.size,!1,this.discardMdatData),s?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):(t.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),i=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,i?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},_.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},_.prototype.processIncompleteMdat=function(){var t,e;return t=this.parsingMdat,e=this.stream.seek(t.start+t.size,!1,this.discardMdatData),e?(o.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},_.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},_.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},_.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&(t.type==="mdat"?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},_.prototype.add=r.Box.prototype.add,_.prototype.addBox=r.Box.prototype.addBox,_.prototype.init=function(t){var e=t||{};this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]);var i=this.add("moov");return i.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",e.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),i.add("mvex"),this},_.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var i=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,i.add("tkhd").set("flags",r.TKHD_FLAG_ENABLED|r.TKHD_FLAG_IN_MOVIE|r.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",e.width).set("height",e.height);var s=i.add("mdia");s.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||"und"),s.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),s.add("elng").set("extended_language",e.language||"fr-FR");var a=s.add("minf");if(r[e.type+"SampleEntry"]!==void 0){var d=new r[e.type+"SampleEntry"];d.data_reference_index=1;var p="";for(var g in r.sampleEntryCodes)for(var y=r.sampleEntryCodes[g],w=0;w<y.length;w++)if(y.indexOf(e.type)>-1){p=g;break}switch(p){case"Visual":if(a.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),d.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24),e.avcDecoderConfigRecord){var b=new r.avcCBox,U=new l(e.avcDecoderConfigRecord);b.parse(U),d.addBox(b)}break;case"Audio":a.add("smhd").set("balance",e.balance||0),d.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||65536);break;case"Hint":a.add("hmhd");break;case"Subtitle":switch(a.add("sthd"),e.type){case"stpp":d.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"");break}break;case"Metadata":a.add("nmhd");break;case"System":a.add("nmhd");break;default:a.add("nmhd");break}e.description&&d.addBox(e.description),e.description_boxes&&e.description_boxes.forEach(function(S){d.addBox(S)}),a.add("dinf").add("dref").addEntry(new r["url Box"]().set("flags",1));var T=a.add("stbl");return T.add("stsd").addEntry(d),T.add("stts").set("sample_counts",[]).set("sample_deltas",[]),T.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),T.add("stco").set("chunk_offsets",[]),T.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(i),e.id}},r.Box.prototype.computeSize=function(t){var e=t||new h;e.endianness=h.BIG_ENDIAN,this.write(e)},_.prototype.addSample=function(t,e,i){var s=i||{},a={},d=this.getTrackById(t);if(d!==null){a.number=d.samples.length,a.track_id=d.tkhd.track_id,a.timescale=d.mdia.mdhd.timescale,a.description_index=s.sample_description_index?s.sample_description_index-1:0,a.description=d.mdia.minf.stbl.stsd.entries[a.description_index],a.data=e,a.size=e.byteLength,a.alreadyRead=a.size,a.duration=s.duration||1,a.cts=s.cts||0,a.dts=s.dts||0,a.is_sync=s.is_sync||!1,a.is_leading=s.is_leading||0,a.depends_on=s.depends_on||0,a.is_depended_on=s.is_depended_on||0,a.has_redundancy=s.has_redundancy||0,a.degradation_priority=s.degradation_priority||0,a.offset=0,a.subsamples=s.subsamples,d.samples.push(a),d.samples_size+=a.size,d.samples_duration+=a.duration,d.first_dts||(d.first_dts=s.dts),this.processSamples();var p=this.createSingleSampleMoof(a);return this.addBox(p),p.computeSize(),p.trafs[0].truns[0].data_offset=p.size+8,this.add("mdat").data=new Uint8Array(e),a}},_.prototype.createSingleSampleMoof=function(t){var e=0;t.is_sync?e=1<<25:e=65536;var i=new r.moofBox;i.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var s=i.add("traf"),a=this.getTrackById(t.track_id);return s.add("tfhd").set("track_id",t.track_id).set("flags",r.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),s.add("tfdt").set("baseMediaDecodeTime",t.dts-a.first_dts),s.add("trun").set("flags",r.TRUN_FLAGS_DATA_OFFSET|r.TRUN_FLAGS_DURATION|r.TRUN_FLAGS_SIZE|r.TRUN_FLAGS_FLAGS|r.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[e]).set("sample_composition_time_offset",[t.cts-t.dts]),i},_.prototype.lastMoofIndex=0,_.prototype.samplesDataSize=0,_.prototype.resetTables=function(){var t,e,i,s,a,d,p,g;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){e=this.moov.traks[t],e.tkhd.duration=0,e.mdia.mdhd.duration=0,i=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,i.chunk_offsets=[],s=e.mdia.minf.stbl.stsc,s.first_chunk=[],s.samples_per_chunk=[],s.sample_description_index=[],a=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,a.sample_sizes=[],d=e.mdia.minf.stbl.stts,d.sample_counts=[],d.sample_deltas=[],p=e.mdia.minf.stbl.ctts,p&&(p.sample_counts=[],p.sample_offsets=[]),g=e.mdia.minf.stbl.stss;var y=e.mdia.minf.stbl.boxes.indexOf(g);y!=-1&&(e.mdia.minf.stbl.boxes[y]=null)}},_.initSampleGroups=function(t,e,i,s,a){var d,p,g,y;function w(b,U,T){this.grouping_type=b,this.grouping_type_parameter=U,this.sbgp=T,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),p=0;p<i.length;p++){for(y=i[p].grouping_type+"/"+i[p].grouping_type_parameter,g=new w(i[p].grouping_type,i[p].grouping_type_parameter,i[p]),e&&(e.sample_groups_info[y]=g),t.sample_groups_info[y]||(t.sample_groups_info[y]=g),d=0;d<s.length;d++)s[d].grouping_type===i[p].grouping_type&&(g.description=s[d],g.description.used=!0);if(a)for(d=0;d<a.length;d++)a[d].grouping_type===i[p].grouping_type&&(g.fragment_description=a[d],g.fragment_description.used=!0,g.is_fragment=!0)}if(e){if(a)for(p=0;p<a.length;p++)!a[p].used&&a[p].version>=2&&(y=a[p].grouping_type+"/0",g=new w(a[p].grouping_type,0),g.is_fragment=!0,e.sample_groups_info[y]||(e.sample_groups_info[y]=g))}else for(p=0;p<s.length;p++)!s[p].used&&s[p].version>=2&&(y=s[p].grouping_type+"/0",g=new w(s[p].grouping_type,0),t.sample_groups_info[y]||(t.sample_groups_info[y]=g))},_.setSampleGroupProperties=function(t,e,i,s){var a,d;e.sample_groups=[];for(a in s)if(e.sample_groups[a]={},e.sample_groups[a].grouping_type=s[a].grouping_type,e.sample_groups[a].grouping_type_parameter=s[a].grouping_type_parameter,i>=s[a].last_sample_in_run&&(s[a].last_sample_in_run<0&&(s[a].last_sample_in_run=0),s[a].entry_index++,s[a].entry_index<=s[a].sbgp.entries.length-1&&(s[a].last_sample_in_run+=s[a].sbgp.entries[s[a].entry_index].sample_count)),s[a].entry_index<=s[a].sbgp.entries.length-1?e.sample_groups[a].group_description_index=s[a].sbgp.entries[s[a].entry_index].group_description_index:e.sample_groups[a].group_description_index=-1,e.sample_groups[a].group_description_index!==0){var p;s[a].fragment_description?p=s[a].fragment_description:p=s[a].description,e.sample_groups[a].group_description_index>0?(e.sample_groups[a].group_description_index>65535?d=(e.sample_groups[a].group_description_index>>16)-1:d=e.sample_groups[a].group_description_index-1,p&&d>=0&&(e.sample_groups[a].description=p.entries[d])):p&&p.version>=2&&p.default_group_description_index>0&&(e.sample_groups[a].description=p.entries[p.default_group_description_index-1])}},_.process_sdtp=function(t,e,i){e&&(t?(e.is_leading=t.is_leading[i],e.depends_on=t.sample_depends_on[i],e.is_depended_on=t.sample_is_depended_on[i],e.has_redundancy=t.sample_has_redundancy[i]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))},_.prototype.buildSampleLists=function(){var t,e;for(t=0;t<this.moov.traks.length;t++)e=this.moov.traks[t],this.buildTrakSampleLists(e)},_.prototype.buildTrakSampleLists=function(t){var e,i,s,a,d,p,g,y,w,b,U,T,S,I,D,L,C,N,R,G,tt,dt,Y,st;if(t.samples=[],t.samples_duration=0,t.samples_size=0,i=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,s=t.mdia.minf.stbl.stsc,a=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,d=t.mdia.minf.stbl.stts,p=t.mdia.minf.stbl.ctts,g=t.mdia.minf.stbl.stss,y=t.mdia.minf.stbl.stsd,w=t.mdia.minf.stbl.subs,T=t.mdia.minf.stbl.stdp,b=t.mdia.minf.stbl.sbgps,U=t.mdia.minf.stbl.sgpds,N=-1,R=-1,G=-1,tt=-1,dt=0,Y=0,st=0,_.initSampleGroups(t,null,b,U),!(typeof a>"u")){for(e=0;e<a.sample_sizes.length;e++){var B={};B.number=e,B.track_id=t.tkhd.track_id,B.timescale=t.mdia.mdhd.timescale,B.alreadyRead=0,t.samples[e]=B,B.size=a.sample_sizes[e],t.samples_size+=B.size,e===0?(I=1,S=0,B.chunk_index=I,B.chunk_run_index=S,C=s.samples_per_chunk[S],L=0,S+1<s.first_chunk.length?D=s.first_chunk[S+1]-1:D=1/0):e<C?(B.chunk_index=I,B.chunk_run_index=S):(I++,B.chunk_index=I,L=0,I<=D||(S++,S+1<s.first_chunk.length?D=s.first_chunk[S+1]-1:D=1/0),B.chunk_run_index=S,C+=s.samples_per_chunk[S]),B.description_index=s.sample_description_index[B.chunk_run_index]-1,B.description=y.entries[B.description_index],B.offset=i.chunk_offsets[B.chunk_index-1]+L,L+=B.size,e>N&&(R++,N<0&&(N=0),N+=d.sample_counts[R]),e>0?(t.samples[e-1].duration=d.sample_deltas[R],t.samples_duration+=t.samples[e-1].duration,B.dts=t.samples[e-1].dts+t.samples[e-1].duration):B.dts=0,p?(e>=G&&(tt++,G<0&&(G=0),G+=p.sample_counts[tt]),B.cts=t.samples[e].dts+p.sample_offsets[tt]):B.cts=B.dts,g?(e==g.sample_numbers[dt]-1?(B.is_sync=!0,dt++):(B.is_sync=!1,B.degradation_priority=0),w&&w.entries[Y].sample_delta+st==e+1&&(B.subsamples=w.entries[Y].subsamples,st+=w.entries[Y].sample_delta,Y++)):B.is_sync=!0,_.process_sdtp(t.mdia.minf.stbl.sdtp,B,B.number),T?B.degradation_priority=T.priority[e]:B.degradation_priority=0,w&&w.entries[Y].sample_delta+st==e&&(B.subsamples=w.entries[Y].subsamples,st+=w.entries[Y].sample_delta),(b.length>0||U.length>0)&&_.setSampleGroupProperties(t,B,e,t.sample_groups_info)}e>0&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}},_.prototype.updateSampleLists=function(){var t,e,i,s,a,d,p,g,y,w,b,U,T,S,I;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(y=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,y.type=="moof")for(w=y,t=0;t<w.trafs.length;t++){for(b=w.trafs[t],U=this.getTrackById(b.tfhd.track_id),T=this.getTrexById(b.tfhd.track_id),b.tfhd.flags&r.TFHD_FLAG_SAMPLE_DESC?s=b.tfhd.default_sample_description_index:s=T?T.default_sample_description_index:1,b.tfhd.flags&r.TFHD_FLAG_SAMPLE_DUR?a=b.tfhd.default_sample_duration:a=T?T.default_sample_duration:0,b.tfhd.flags&r.TFHD_FLAG_SAMPLE_SIZE?d=b.tfhd.default_sample_size:d=T?T.default_sample_size:0,b.tfhd.flags&r.TFHD_FLAG_SAMPLE_FLAGS?p=b.tfhd.default_sample_flags:p=T?T.default_sample_flags:0,b.sample_number=0,b.sbgps.length>0&&_.initSampleGroups(U,b,b.sbgps,U.mdia.minf.stbl.sgpds,b.sgpds),e=0;e<b.truns.length;e++){var D=b.truns[e];for(i=0;i<D.sample_count;i++){S={},S.moof_number=this.lastMoofIndex,S.number_in_traf=b.sample_number,b.sample_number++,S.number=U.samples.length,b.first_sample_index=U.samples.length,U.samples.push(S),S.track_id=U.tkhd.track_id,S.timescale=U.mdia.mdhd.timescale,S.description_index=s-1,S.description=U.mdia.minf.stbl.stsd.entries[S.description_index],S.size=d,D.flags&r.TRUN_FLAGS_SIZE&&(S.size=D.sample_size[i]),U.samples_size+=S.size,S.duration=a,D.flags&r.TRUN_FLAGS_DURATION&&(S.duration=D.sample_duration[i]),U.samples_duration+=S.duration,U.first_traf_merged||i>0?S.dts=U.samples[U.samples.length-2].dts+U.samples[U.samples.length-2].duration:(b.tfdt?S.dts=b.tfdt.baseMediaDecodeTime:S.dts=0,U.first_traf_merged=!0),S.cts=S.dts,D.flags&r.TRUN_FLAGS_CTS_OFFSET&&(S.cts=S.dts+D.sample_composition_time_offset[i]),I=p,D.flags&r.TRUN_FLAGS_FLAGS?I=D.sample_flags[i]:i===0&&D.flags&r.TRUN_FLAGS_FIRST_FLAG&&(I=D.first_sample_flags),S.is_sync=!(I>>16&1),S.is_leading=I>>26&3,S.depends_on=I>>24&3,S.is_depended_on=I>>22&3,S.has_redundancy=I>>20&3,S.degradation_priority=I&65535;var L=!!(b.tfhd.flags&r.TFHD_FLAG_BASE_DATA_OFFSET),C=!!(b.tfhd.flags&r.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),N=!!(D.flags&r.TRUN_FLAGS_DATA_OFFSET),R=0;L?R=b.tfhd.base_data_offset:C||e===0?R=w.start:R=g,e===0&&i===0?N?S.offset=R+D.data_offset:S.offset=R:S.offset=g,g=S.offset+S.size,(b.sbgps.length>0||b.sgpds.length>0||U.mdia.minf.stbl.sbgps.length>0||U.mdia.minf.stbl.sgpds.length>0)&&_.setSampleGroupProperties(U,S,S.number_in_traf,b.sample_groups_info)}}if(b.subs){U.has_fragment_subsamples=!0;var G=b.first_sample_index;for(e=0;e<b.subs.entries.length;e++)G+=b.subs.entries[e].sample_delta,S=U.samples[G-1],S.subsamples=b.subs.entries[e].subsamples}}}},_.prototype.getSample=function(t,e){var i,s=t.samples[e];if(!this.moov)return null;if(!s.data)s.data=new Uint8Array(s.size),s.alreadyRead=0,this.samplesDataSize+=s.size,o.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+s.size+" (total: "+this.samplesDataSize+")");else if(s.alreadyRead==s.size)return s;for(;;){var a=this.stream.findPosition(!0,s.offset+s.alreadyRead,!1);if(a>-1){i=this.stream.buffers[a];var d=i.byteLength-(s.offset+s.alreadyRead-i.fileStart);if(s.size-s.alreadyRead<=d)return o.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-i.fileStart)+" read size: "+(s.size-s.alreadyRead)+" full size: "+s.size+")"),h.memcpy(s.data.buffer,s.alreadyRead,i,s.offset+s.alreadyRead-i.fileStart,s.size-s.alreadyRead),i.usedBytes+=s.size-s.alreadyRead,this.stream.logBufferLevel(),s.alreadyRead=s.size,s;if(d===0)return null;o.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-i.fileStart)+" read size: "+d+" full size: "+s.size+")"),h.memcpy(s.data.buffer,s.alreadyRead,i,s.offset+s.alreadyRead-i.fileStart,d),s.alreadyRead+=d,i.usedBytes+=d,this.stream.logBufferLevel()}else return null}},_.prototype.releaseSample=function(t,e){var i=t.samples[e];return i.data?(this.samplesDataSize-=i.size,i.data=null,i.alreadyRead=0,i.size):0},_.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},_.prototype.getCodecs=function(){var t,e="";for(t=0;t<this.moov.traks.length;t++){var i=this.moov.traks[t];t>0&&(e+=","),e+=i.mdia.minf.stbl.stsd.entries[0].getCodec()}return e},_.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var i=this.moov.mvex.trexs[e];if(i.track_id==t)return i}return null},_.prototype.getTrackById=function(t){if(this.moov===void 0)return null;for(var e=0;e<this.moov.traks.length;e++){var i=this.moov.traks[e];if(i.tkhd.track_id==t)return i}return null},_.prototype.items=[],_.prototype.itemsDataSize=0,_.prototype.flattenItemInfo=function(){var t=this.items,e,i,s,a=this.meta;if(a!=null&&a.hdlr!==void 0&&a.iinf!==void 0){for(e=0;e<a.iinf.item_infos.length;e++)s={},s.id=a.iinf.item_infos[e].item_ID,t[s.id]=s,s.ref_to=[],s.name=a.iinf.item_infos[e].item_name,a.iinf.item_infos[e].protection_index>0&&(s.protection=a.ipro.protections[a.iinf.item_infos[e].protection_index-1]),a.iinf.item_infos[e].item_type?s.type=a.iinf.item_infos[e].item_type:s.type="mime",s.content_type=a.iinf.item_infos[e].content_type,s.content_encoding=a.iinf.item_infos[e].content_encoding;if(a.iloc)for(e=0;e<a.iloc.items.length;e++){var d=a.iloc.items[e];switch(s=t[d.item_ID],d.data_reference_index!==0&&(o.warn("Item storage with reference to other files: not supported"),s.source=a.dinf.boxes[d.data_reference_index-1]),d.construction_method){case 0:break;case 1:o.warn("Item storage with construction_method : not supported");break;case 2:o.warn("Item storage with construction_method : not supported");break}for(s.extents=[],s.size=0,i=0;i<d.extents.length;i++)s.extents[i]={},s.extents[i].offset=d.extents[i].extent_offset+d.base_offset,s.extents[i].length=d.extents[i].extent_length,s.extents[i].alreadyRead=0,s.size+=s.extents[i].length}if(a.pitm&&(t[a.pitm.item_id].primary=!0),a.iref)for(e=0;e<a.iref.references.length;e++){var p=a.iref.references[e];for(i=0;i<p.references.length;i++)t[p.from_item_ID].ref_to.push({type:p.type,id:p.references[i]})}if(a.iprp)for(var g=0;g<a.iprp.ipmas.length;g++){var y=a.iprp.ipmas[g];for(e=0;e<y.associations.length;e++){var w=y.associations[e];for(s=t[w.id],s.properties===void 0&&(s.properties={},s.properties.boxes=[]),i=0;i<w.props.length;i++){var b=w.props[i];if(b.property_index>0&&b.property_index-1<a.iprp.ipco.boxes.length){var U=a.iprp.ipco.boxes[b.property_index-1];s.properties[U.type]=U,s.properties.boxes.push(U)}}}}}},_.prototype.getItem=function(t){var e,i;if(!this.meta)return null;if(i=this.items[t],!i.data&&i.size)i.data=new Uint8Array(i.size),i.alreadyRead=0,this.itemsDataSize+=i.size,o.debug("ISOFile","Allocating item #"+t+" of size "+i.size+" (total: "+this.itemsDataSize+")");else if(i.alreadyRead===i.size)return i;for(var s=0;s<i.extents.length;s++){var a=i.extents[s];if(a.alreadyRead!==a.length){var d=this.stream.findPosition(!0,a.offset+a.alreadyRead,!1);if(d>-1){e=this.stream.buffers[d];var p=e.byteLength-(a.offset+a.alreadyRead-e.fileStart);if(a.length-a.alreadyRead<=p)o.debug("ISOFile","Getting item #"+t+" extent #"+s+" data (alreadyRead: "+a.alreadyRead+" offset: "+(a.offset+a.alreadyRead-e.fileStart)+" read size: "+(a.length-a.alreadyRead)+" full extent size: "+a.length+" full item size: "+i.size+")"),h.memcpy(i.data.buffer,i.alreadyRead,e,a.offset+a.alreadyRead-e.fileStart,a.length-a.alreadyRead),e.usedBytes+=a.length-a.alreadyRead,this.stream.logBufferLevel(),i.alreadyRead+=a.length-a.alreadyRead,a.alreadyRead=a.length;else return o.debug("ISOFile","Getting item #"+t+" extent #"+s+" partial data (alreadyRead: "+a.alreadyRead+" offset: "+(a.offset+a.alreadyRead-e.fileStart)+" read size: "+p+" full extent size: "+a.length+" full item size: "+i.size+")"),h.memcpy(i.data.buffer,i.alreadyRead,e,a.offset+a.alreadyRead-e.fileStart,p),a.alreadyRead+=p,i.alreadyRead+=p,e.usedBytes+=p,this.stream.logBufferLevel(),null}else return null}}return i.alreadyRead===i.size?i:null},_.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var i=0;i<e.extents.length;i++){var s=e.extents[i];s.alreadyRead=0}return e.size}else return 0},_.prototype.processItems=function(t){for(var e in this.items){var i=this.items[e];this.getItem(i.id),t&&!i.sent&&(t(i),i.sent=!0,i.data=null)}},_.prototype.hasItem=function(t){for(var e in this.items){var i=this.items[e];if(i.name===t)return i.id}return-1},_.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},_.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},_.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},i=null;if(e.itemId?i=this.getItem(e.itemId):i=this.getPrimaryItem(),i==null)return null;var s=new _;s.discardMdatData=!1;var a={type:i.type,description_boxes:i.properties.boxes};i.properties.ispe&&(a.width=i.properties.ispe.image_width,a.height=i.properties.ispe.image_height);var d=s.addTrack(a);return d?(s.addSample(d,i.data),s):null},_.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)},_.prototype.createFragment=function(t,e,i){var s=this.getTrackById(t),a=this.getSample(s,e);if(a==null)return a=s.samples[e],this.nextSeekPosition?this.nextSeekPosition=Math.min(a.offset+a.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=s.samples[e].offset+a.alreadyRead,null;var d=i||new h;d.endianness=h.BIG_ENDIAN;var p=this.createSingleSampleMoof(a);p.write(d),p.trafs[0].truns[0].data_offset=p.size+8,o.debug("MP4Box","Adjusting data_offset with new value "+p.trafs[0].truns[0].data_offset),d.adjustUint32(p.trafs[0].truns[0].data_offset_position,p.trafs[0].truns[0].data_offset);var g=new r.mdatBox;return g.data=a.data,g.write(d),d},_.writeInitializationSegment=function(t,e,i,s){var a;o.debug("ISOFile","Generating initialization segment");var d=new h;d.endianness=h.BIG_ENDIAN,t.write(d);var p=e.add("mvex");for(i&&p.add("mehd").set("fragment_duration",i),a=0;a<e.traks.length;a++)p.add("trex").set("track_id",e.traks[a].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",s).set("default_sample_size",0).set("default_sample_flags",65536);return e.write(d),d.buffer},_.prototype.save=function(t){var e=new h;e.endianness=h.BIG_ENDIAN,this.write(e),e.save(t)},_.prototype.getBuffer=function(){var t=new h;return t.endianness=h.BIG_ENDIAN,this.write(t),t.buffer},_.prototype.initializeSegmentation=function(){var t,e,i,s;for(this.onSegment===null&&o.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),e=[],t=0;t<this.fragmentedTracks.length;t++){var a=new r.moovBox;a.mvhd=this.moov.mvhd,a.boxes.push(a.mvhd),i=this.getTrackById(this.fragmentedTracks[t].id),a.boxes.push(i),a.traks.push(i),s={},s.id=i.tkhd.track_id,s.user=this.fragmentedTracks[t].user,s.buffer=_.writeInitializationSegment(this.ftyp,a,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[t].samples.length>0?this.moov.traks[t].samples[0].duration:0),e.push(s)}return e},r.Box.prototype.printHeader=function(t){this.size+=8,this.size>f&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},r.FullBox.prototype.printHeader=function(t){this.size+=4,r.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},r.Box.prototype.print=function(t){this.printHeader(t)},r.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var e=0;e<this.boxes.length;e++)if(this.boxes[e]){var i=t.indent;t.indent+=" ",this.boxes[e].print(t),t.indent=i}},_.prototype.print=function(t){t.indent="";for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&this.boxes[e].print(t)},r.mvhdBox.prototype.print=function(t){r.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},r.tkhdBox.prototype.print=function(t){r.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var x={};x.createFile=function(t,e){var i=t!==void 0?t:!0,s=new _(e);return s.discardMdatData=!i,s},n.createFile=x.createFile})(ho);function lo(n){let o,l="<p>Loading Sketch...</p>";return{c(){o=$("div"),o.innerHTML=l,this.h()},l(h){o=q(h,"DIV",{class:!0,"data-svelte-h":!0}),pt(o)!=="svelte-7f3u5x"&&(o.innerHTML=l),this.h()},h(){X(o,"class","w-full h-96 border rounded-lg flex items-center justify-center")},m(h,f){jt(h,o,f)},p:_t,i:_t,o:_t,d(h){h&&ht(o)}}}function fo(n){let o,l,h;var f=n[0];function u(c,r){return{props:{script:c[1]}}}return f&&(o=Re(f,u(n))),{c(){o&&de(o.$$.fragment),l=Oe()},l(c){o&&ai(o.$$.fragment,c),l=Oe()},m(c,r){o&&ce(o,c,r),jt(c,l,r),h=!0},p(c,r){if(r&1&&f!==(f=c[0])){if(o){li();const m=o;zt(m.$$.fragment,1,0,()=>{pe(m,1)}),hi()}f?(o=Re(f,u(c)),de(o.$$.fragment),It(o.$$.fragment,1),ce(o,l.parentNode,l)):o=null}},i(c){h||(o&&It(o.$$.fragment,c),h=!0)},o(c){o&&zt(o.$$.fragment,c),h=!1},d(c){c&&ht(l),o&&pe(o,c)}}}function uo(n){let o,l,h="Style Guide",f,u,c='<h2 class="text-3xl font-serif mb-4 pb-2 border-b">Typography</h2> <h1 class="text-5xl font-serif font-bold">Heading 1</h1> <p class="font-sans mt-4">Body text for paragraphs.</p>',r,m,v,_,x,t="p5.js Sketch",e,i,s,a,d,p,g,y,w="D3 Visualization",b,U,T;const S=[fo,lo],I=[];function D(L,C){return L[0]?0:1}return i=D(n),s=I[i]=S[i](n),U=new oo({}),{c(){o=$("div"),l=$("h1"),l.textContent=h,f=ot(),u=$("section"),u.innerHTML=c,r=ot(),m=$("hr"),v=ot(),_=$("section"),x=$("h2"),x.textContent=t,e=ot(),s.c(),a=ot(),d=$("hr"),p=ot(),g=$("section"),y=$("h2"),y.textContent=w,b=ot(),de(U.$$.fragment),this.h()},l(L){o=q(L,"DIV",{class:!0});var C=le(o);l=q(C,"H1",{class:!0,"data-svelte-h":!0}),pt(l)!=="svelte-1u1n0ad"&&(l.textContent=h),f=at(C),u=q(C,"SECTION",{class:!0,"data-svelte-h":!0}),pt(u)!=="svelte-1182vhf"&&(u.innerHTML=c),r=at(C),m=q(C,"HR",{class:!0}),v=at(C),_=q(C,"SECTION",{class:!0});var N=le(_);x=q(N,"H2",{class:!0,"data-svelte-h":!0}),pt(x)!=="svelte-195oeh1"&&(x.textContent=t),e=at(N),s.l(N),N.forEach(ht),a=at(C),d=q(C,"HR",{class:!0}),p=at(C),g=q(C,"SECTION",{class:!0});var R=le(g);y=q(R,"H2",{class:!0,"data-svelte-h":!0}),pt(y)!=="svelte-j99oii"&&(y.textContent=w),b=at(R),ai(U.$$.fragment,R),R.forEach(ht),C.forEach(ht),this.h()},h(){X(l,"class","text-5xl font-serif font-bold text-center mb-16"),X(u,"class","mb-12"),X(m,"class","my-12"),X(x,"class","text-3xl font-serif mb-4 pb-2 border-b"),X(_,"class","mb-12"),X(d,"class","my-12"),X(y,"class","text-3xl font-serif mb-4 pb-2 border-b"),X(g,"class","mb-12"),X(o,"class","container mx-auto px-4 py-12")},m(L,C){jt(L,o,C),O(o,l),O(o,f),O(o,u),O(o,r),O(o,m),O(o,v),O(o,_),O(_,x),O(_,e),I[i].m(_,null),O(o,a),O(o,d),O(o,p),O(o,g),O(g,y),O(g,b),ce(U,g,null),T=!0},p(L,[C]){let N=i;i=D(L),i===N?I[i].p(L,C):(li(),zt(I[N],1,1,()=>{I[N]=null}),hi(),s=I[i],s?s.p(L,C):(s=I[i]=S[i](L),s.c()),It(s,1),s.m(_,null))},i(L){T||(It(s),It(U.$$.fragment,L),T=!0)},o(L){zt(s),zt(U.$$.fragment,L),T=!1},d(L){L&&ht(o),I[i].d(),pe(U)}}}function co(n,o,l){let h;return ri(async()=>{const u=await Oi(()=>import("./P5Sketch.1e7781eb.js"),["./P5Sketch.1e7781eb.js","./scheduler.cc4696a9.js","./index.3d0bf3b5.js"],import.meta.url);l(0,h=u.default)}),[h,u=>{u.setup=()=>{u.createCanvas(u.windowWidth,384)},u.draw=()=>{u.mouseIsPressed?(u.fill(u.random(255),u.random(255),u.random(255)),u.ellipse(u.mouseX,u.mouseY,80,80)):u.fill(255),u.background(20)}}]}class mo extends si{constructor(o){super(),oi(this,o,co,uo,ni,{})}}export{mo as P,ao as c,yo as g};
